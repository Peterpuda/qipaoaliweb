# ✅ 阿里云部署检查清单

使用此清单确保部署的每个步骤都已正确完成。

---

## 📋 第一阶段：准备工作

### 阿里云账号准备
- [ ] 已注册阿里云账号
- [ ] 已完成实名认证（企业/个人）
- [ ] 已充值账户余额（建议¥2000+）
- [ ] 已开通按量付费权限
- [ ] 记录账号ID: `_______________`

### 服务购买
- [ ] 已创建RDS MySQL实例
  - 规格: mysql.n2.medium.1 (2核4GB)
  - 存储: 100GB SSD
  - 地域: 华东2（上海）
  - 连接地址: `_______________`
  - 密码已记录: ✅
  
- [ ] 已创建OSS Bucket（前端）
  - 名称: `songbrocade-frontend`
  - 权限: 公共读
  - 版本控制: 已开启
  
- [ ] 已创建OSS Bucket（媒体）
  - 名称: `songbrocade-media`
  - 权限: 私有
  - 版本控制: 已开启
  
- [ ] 已创建AccessKey
  - AccessKey ID: `LTAI5t_______________`
  - AccessKey Secret: 已安全保存 ✅

### 数据库配置
- [ ] 已配置RDS白名单
  - 白名单IP: `0.0.0.0/0` (测试) 或具体IP
  
- [ ] 已创建数据库
  ```sql
  CREATE DATABASE songbrocade CHARACTER SET utf8mb4;
  ```
  
- [ ] 已执行建表SQL
  - [ ] events 表
  - [ ] checkins 表
  - [ ] members 表
  - [ ] products 表
  - [ ] artisans 表
  - [ ] orders 表
  - [ ] rewards 表
  - [ ] content_variants 表
  - [ ] badges_issues 表
  - [ ] shipping_info 表
  - [ ] admin_sessions 表
  
- [ ] 已创建索引
- [ ] 已测试数据库连接

---

## 📋 第二阶段：GitHub配置

### 仓库创建
- [ ] 已创建GitHub仓库
  - 仓库名: `_______________`
  - 可见性: Private / Public
  - URL: `https://github.com/_______________`

### 代码推送
- [ ] 已初始化Git仓库
  ```bash
  git init
  ```
  
- [ ] 已添加远程仓库
  ```bash
  git remote add origin https://github.com/...
  ```
  
- [ ] 已推送代码
  ```bash
  git push -u origin main
  ```

### GitHub Secrets配置

#### 基础配置（3个）
- [ ] `ALIYUN_ACCOUNT_ID` - 阿里云账号ID
- [ ] `ALIYUN_ACCESS_KEY_ID` - AccessKey ID
- [ ] `ALIYUN_ACCESS_KEY_SECRET` - AccessKey Secret

#### OSS配置（3个）
- [ ] `OSS_REGION` - oss-cn-shanghai
- [ ] `OSS_BUCKET` - songbrocade-frontend
- [ ] `OSS_BUCKET_MEDIA` - songbrocade-media

#### 数据库配置（5个）
- [ ] `DB_HOST` - RDS连接地址
- [ ] `DB_PORT` - 3306
- [ ] `DB_USER` - root
- [ ] `DB_PASSWORD` - 数据库密码
- [ ] `DB_NAME` - songbrocade

#### 区块链配置（3个）
- [ ] `RPC_URL` - https://sepolia.base.org
- [ ] `BROCADE_ADDR` - 合约地址
- [ ] `RDA_REG_ADDR` - 合约地址

#### AI服务配置（2个）
- [ ] `OPENAI_API_KEY` - sk-...
- [ ] `REPLICATE_API_KEY` - r8_...

#### 业务配置（2个）
- [ ] `ADMIN_WALLETS` - 管理员钱包地址
- [ ] `SHIPPING_KEY` - 加密密钥

#### 可选配置（2个）
- [ ] `CDN_DOMAIN` - www.songbrocade.com
- [ ] `DINGTALK_WEBHOOK` - 钉钉通知

**总计: 20个Secrets** ✅

---

## 📋 第三阶段：代码改造

### 后端代码
- [ ] 已创建 `worker-api/utils/db-mysql.js`
- [ ] 已创建 `worker-api/utils/oss-client.js`
- [ ] 已安装依赖
  ```bash
  cd worker-api
  npm install mysql2 ali-oss
  ```
  
- [ ] 已修改 `worker-api/index.js`
  - [ ] 导入db-mysql
  - [ ] 导入oss-client
  - [ ] 初始化连接池
  - [ ] 初始化OSS客户端
  
- [ ] 已替换所有D1查询为MySQL
- [ ] 已替换所有R2操作为OSS

### 前端代码
- [ ] 已更新 `frontend/common/api.js`
  - API_BASE改为阿里云地址
  
- [ ] 已更新媒体文件URL
  - 从R2 URL改为OSS URL

### 配置文件
- [ ] 已创建 `.github/workflows/deploy-frontend.yml`
- [ ] 已创建 `.github/workflows/deploy-backend.yml`
- [ ] 已创建 `worker-api/.env.local`（本地测试用）

---

## 📋 第四阶段：本地测试

### 后端测试
- [ ] 已测试数据库连接
  ```bash
  cd worker-api
  node test-db.js
  ```
  
- [ ] 已测试OSS连接
  ```bash
  node test-oss.js
  ```
  
- [ ] 已启动本地服务器
  ```bash
  node index.js
  ```
  
- [ ] 已测试API端点
  - [ ] GET /health
  - [ ] POST /auth/challenge
  - [ ] GET /products
  - [ ] POST /orders
  - [ ] GET /ai/narrative/product/:id

### 前端测试
- [ ] 已启动本地服务器
  ```bash
  cd frontend
  python3 -m http.server 8080
  ```
  
- [ ] 已测试页面访问
  - [ ] 首页
  - [ ] 商品列表
  - [ ] 商品详情
  - [ ] 签到页面
  - [ ] 管理后台

### 集成测试
- [ ] 前后端联调成功
- [ ] 数据库读写正常
- [ ] 文件上传下载正常
- [ ] 区块链交互正常

---

## 📋 第五阶段：部署上线

### GitHub Actions部署

#### 前端部署
- [ ] 已触发前端部署工作流
  - 方式: 推送代码到main分支
  
- [ ] 前端部署成功
  - [ ] 文件已上传到OSS
  - [ ] 缓存策略已设置
  - [ ] CDN缓存已刷新（如配置）
  
- [ ] 前端访问正常
  - URL: `https://songbrocade-frontend.oss-cn-shanghai.aliyuncs.com`
  - 测试: `curl -I https://...`

#### 后端部署
- [ ] 已触发后端部署工作流
  
- [ ] 后端部署成功
  - [ ] 函数已创建
  - [ ] 环境变量已配置
  - [ ] HTTP触发器已创建
  
- [ ] 后端访问正常
  - URL: `https://_______________`
  - 测试: `curl https://.../health`

### 验证部署

#### 功能验证
- [ ] 用户注册登录
- [ ] 钱包连接
- [ ] 签到打卡
- [ ] NFT铸造
- [ ] 商品浏览
- [ ] 文化故事展示
  - [ ] 文字版
  - [ ] 语音版
  - [ ] 视频版
- [ ] 购物车
- [ ] 下单支付
- [ ] 空投领取
- [ ] 管理后台
  - [ ] 活动管理
  - [ ] 商品管理
  - [ ] 订单管理
  - [ ] AI生成

#### 性能验证
- [ ] 页面加载时间 < 3秒
- [ ] API响应时间 < 500ms
- [ ] 数据库查询 < 100ms
- [ ] 文件加载速度正常

#### 兼容性验证
- [ ] PC端浏览器
  - [ ] Chrome
  - [ ] Firefox
  - [ ] Safari
  - [ ] Edge
- [ ] 移动端
  - [ ] iOS Safari
  - [ ] Android Chrome
- [ ] 多语言
  - [ ] 中文
  - [ ] 英文
  - [ ] 日文
  - [ ] 法文
  - [ ] 西班牙文
  - [ ] 俄文
  - [ ] 马来文

---

## 📋 第六阶段：监控配置

### 云监控
- [ ] 已配置RDS监控
  - [ ] CPU使用率告警 > 80%
  - [ ] 内存使用率告警 > 80%
  - [ ] 磁盘使用率告警 > 80%
  - [ ] 连接数告警
  
- [ ] 已配置OSS监控
  - [ ] 存储空间告警
  - [ ] 流量告警
  - [ ] 请求数告警
  
- [ ] 已配置FC监控
  - [ ] 调用次数监控
  - [ ] 错误率告警 > 1%
  - [ ] 执行时间告警
  - [ ] 内存使用告警

### 日志服务
- [ ] 已开通SLS日志服务
- [ ] 已配置应用日志收集
- [ ] 已配置访问日志收集
- [ ] 已配置错误日志告警

### 备份策略
- [ ] 已配置RDS自动备份
  - 备份周期: 每天
  - 保留天数: 7天
  
- [ ] 已配置OSS版本控制
- [ ] 已配置数据库手动备份计划

---

## 📋 第七阶段：域名配置（可选）

### 域名备案
- [ ] 已提交ICP备案申请
- [ ] 备案审核通过
- [ ] 备案号: `_______________`

### CDN配置
- [ ] 已添加加速域名
  - 前端: `www.songbrocade.com`
  - 后端: `api.songbrocade.com`
  
- [ ] 已配置HTTPS证书
  - [ ] 证书已申请
  - [ ] 证书已上传
  - [ ] 强制HTTPS已开启
  
- [ ] 已配置缓存规则
- [ ] 已配置回源设置

### DNS解析
- [ ] 已添加DNS记录
  - [ ] www CNAME → CDN域名
  - [ ] api CNAME → FC域名
  - [ ] @ A/CNAME → www
  
- [ ] DNS解析已生效
  - 测试: `nslookup www.songbrocade.com`

---

## 📋 第八阶段：文档整理

### 运维文档
- [ ] 服务器信息文档
- [ ] 数据库信息文档
- [ ] 域名和证书信息
- [ ] 监控告警配置
- [ ] 日常运维操作手册
- [ ] 故障处理流程
- [ ] 备份恢复流程

### 开发文档
- [ ] 项目结构说明
- [ ] 本地开发环境搭建
- [ ] API文档
- [ ] 数据库设计文档
- [ ] 部署流程文档

### 用户文档
- [ ] 用户使用指南
- [ ] 常见问题FAQ
- [ ] 视频教程（可选）

---

## 📋 第九阶段：团队培训

### 运维培训
- [ ] 阿里云控制台使用
- [ ] 日志查看和分析
- [ ] 监控告警处理
- [ ] 数据库备份恢复
- [ ] 紧急故障处理
- [ ] 回滚操作演练

### 开发培训
- [ ] 新架构说明
- [ ] 代码变更点讲解
- [ ] 本地开发流程
- [ ] 部署流程演示
- [ ] 调试技巧分享

---

## 📋 第十阶段：上线验收

### 功能验收
- [ ] 所有功能正常运行
- [ ] 无P0/P1级别bug
- [ ] 性能指标达标
- [ ] 安全测试通过

### 用户验收
- [ ] 内部用户测试通过
- [ ] 外部用户试用反馈良好
- [ ] 无重大用户投诉

### 项目交付
- [ ] 所有文档已交付
- [ ] 团队培训已完成
- [ ] 运维交接已完成
- [ ] 项目总结报告已提交

---

## 🎉 部署完成标准

当以下所有条件满足时，视为部署完成：

- ✅ 所有服务正常运行
- ✅ 所有功能测试通过
- ✅ 性能指标达标
- ✅ 监控告警配置完成
- ✅ 文档齐全
- ✅ 团队培训完成
- ✅ 稳定运行7天以上
- ✅ 用户反馈良好

---

## 📊 关键指标

### 性能指标
- [ ] 页面加载时间 < 3秒 ✅
- [ ] API响应时间 < 500ms ✅
- [ ] 数据库查询 < 100ms ✅
- [ ] CDN缓存命中率 > 90% ✅

### 可用性指标
- [ ] 服务可用性 > 99.9% ✅
- [ ] 错误率 < 0.1% ✅
- [ ] 成功部署率 > 95% ✅

### 成本指标
- [ ] 月度成本 < ¥800 ✅
- [ ] 成本在预算内 ✅

---

## 🆘 问题记录

在部署过程中遇到的问题和解决方案：

### 问题1
- **问题描述**: _______________
- **解决方案**: _______________
- **记录时间**: _______________

### 问题2
- **问题描述**: _______________
- **解决方案**: _______________
- **记录时间**: _______________

---

## ✅ 最终确认

- [ ] 我已完成所有检查项
- [ ] 所有服务运行正常
- [ ] 所有文档已整理
- [ ] 团队已培训完成
- [ ] 项目可以正式上线

**签名**: _______________  
**日期**: _______________

---

**祝贺您完成部署！** 🎉

