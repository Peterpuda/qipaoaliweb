# Merkle Tree ç”ŸæˆåŠŸèƒ½è®¾ç½®å®Œæˆ

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ç®¡ç†åŽå°æ·»åŠ  Merkle å…¥å£ âœ…

**ä½ç½®**: `/admin/index.html`

æ·»åŠ äº†æ˜¾è‘—çš„ Merkle Tree ç”Ÿæˆæ¨¡å—ï¼ŒåŒ…æ‹¬ï¼š
- ðŸ“Š ç®¡ç†åŽå°é¦–é¡µä¸­çš„ä¸“ç”¨åŒºå—ï¼ˆé‡‘è‰²è¾¹æ¡†é«˜äº®ï¼‰
- ðŸ”— ä¾§è¾¹æ å¯¼èˆªä¸­çš„å¿«é€Ÿå…¥å£
- ðŸ“ è¯¦ç»†çš„æ“ä½œæ­¥éª¤è¯´æ˜Ž
- âš ï¸ é‡è¦æç¤ºæ¡†

### 2. ä¿®å¤ Token è®¤è¯ âœ…

**æ–‡ä»¶**: `/admin/merkle.html`

ä¿®å¤äº†ç™»å½• token èŽ·å–é€»è¾‘ï¼š
```javascript
// æ—§ä»£ç ï¼ˆé”™è¯¯ï¼‰
const token = localStorage.getItem('admin_token');

// æ–°ä»£ç ï¼ˆæ­£ç¡®ï¼‰
const token = sessionStorage.getItem('qipao.admin.token') || 
              localStorage.getItem('qipao.admin.token') || 
              localStorage.getItem('bearer_token') || '';
```

### 3. æ”¯æŒ Slug è¾“å…¥ âœ…

**å‰ç«¯ + åŽç«¯**

çŽ°åœ¨å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ç”Ÿæˆ Merkle Treeï¼š
- æ•°å­— IDï¼š`24`
- Slugï¼š`airdrop-2025`

åŽç«¯ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶è½¬æ¢ã€‚

### 4. éƒ¨ç½²çŠ¶æ€ âœ…

- âœ… Worker API å·²éƒ¨ç½²
- âœ… ç‰ˆæœ¬ ID: `9660e7e2-da38-4e55-9cc4-cf0f509fa600`
- âœ… ä»£ç å·²æŽ¨é€åˆ° GitHub

## ðŸ“‹ ä½¿ç”¨æ–¹æ³•

### æ­¥éª¤ 1ï¼šè®¿é—®ç®¡ç†åŽå°

è®¿é—®ï¼šhttps://songbrocade-frontend.pages.dev/admin/

### æ­¥éª¤ 2ï¼šè¿žæŽ¥é’±åŒ…ç™»å½•

ä½¿ç”¨ç®¡ç†å‘˜é’±åŒ…åœ°å€ç™»å½•ï¼ˆé…ç½®åœ¨ `ADMIN_WALLETS` ä¸­ï¼‰

### æ­¥éª¤ 3ï¼šæ‰“å¼€ Merkle ç”Ÿæˆå·¥å…·

ä¸¤ç§æ–¹å¼ï¼š
1. åœ¨é¦–é¡µæ‰¾åˆ° "ðŸŽ Merkle Tree ç”Ÿæˆ" æ¨¡å—ï¼Œç‚¹å‡»"ç”Ÿæˆ Merkle Tree"æŒ‰é’®
2. ä»Žå·¦ä¾§å¯¼èˆªæ ç‚¹å‡» "Merkle Tree ç”Ÿæˆ"ï¼ˆé‡‘è‰²å›¾æ ‡ï¼‰

### æ­¥éª¤ 4ï¼šç”Ÿæˆ Merkle Tree

1. è¾“å…¥æ´»åŠ¨æ ‡è¯†ï¼š
   - å¯ä»¥è¾“å…¥æ•°å­— IDï¼ˆå¦‚ï¼š`24`ï¼‰
   - æˆ–è€…è¾“å…¥ slugï¼ˆå¦‚ï¼š`airdrop-2025`ï¼‰

2. ç‚¹å‡»"ðŸ“‹ åŠ è½½æ´»åŠ¨ä¿¡æ¯"
   - æ˜¾ç¤ºæ´»åŠ¨åç§°
   - æ˜¾ç¤ºç­¾åˆ°äººæ•°
   - æ˜¾ç¤º Merkle çŠ¶æ€

3. ç‚¹å‡»"ðŸš€ ç”Ÿæˆ Merkle Tree"
   - ç³»ç»Ÿä¼šä¸ºæ‰€æœ‰ç­¾åˆ°ç”¨æˆ·ç”Ÿæˆ Merkle è¯æ˜Ž
   - æ˜¾ç¤º Merkle Rootï¼ˆé‡è¦ï¼è®°å½•ä¸‹æ¥ï¼‰

### æ­¥éª¤ 5ï¼šéƒ¨ç½²åˆçº¦

ä½¿ç”¨ç”Ÿæˆçš„ Merkle Root éƒ¨ç½² MerkleDistributor åˆçº¦ï¼š

```bash
cd contracts

# é…ç½®çŽ¯å¢ƒå˜é‡
cat > .env << EOF
PRIVATE_KEY=your_private_key
BASE_SEPOLIA_RPC=https://sepolia.base.org
TOKEN_ADDRESS=0x9Fc8A071c5a6897AD90c8614de5B26e4e75a57Aa
MERKLE_ROOT=0x...  # ä»Žæ­¥éª¤4èŽ·å–
EOF

# éƒ¨ç½²åˆçº¦
node scripts/deploy-erc20-distributor.js
```

### æ­¥éª¤ 6ï¼šé…ç½®å‰ç«¯

ç¼–è¾‘ `frontend/poap.config.js`ï¼š

```javascript
DISTRIBUTOR_CONTRACT: "0xä½ éƒ¨ç½²çš„åˆçº¦åœ°å€",
```

### æ­¥éª¤ 7ï¼šè½¬å…¥ä»£å¸

å°†ä»£å¸è½¬å…¥åˆçº¦åœ°å€ï¼š
```
ç›®æ ‡ï¼šåˆçº¦åœ°å€
ä»£å¸ï¼š0x9Fc8A071c5a6897AD90c8614de5B26e4e75a57Aa
æ•°é‡ï¼šç­¾åˆ°äººæ•° Ã— 1000
```

## ðŸŽ¯ å®Œæ•´å·¥ä½œæµç¨‹

```
ç”¨æˆ·ç­¾åˆ°
  â†“
ç®¡ç†å‘˜è®¿é—® /admin/
  â†“
ç‚¹å‡»"Merkle Tree ç”Ÿæˆ"
  â†“
è¾“å…¥æ´»åŠ¨æ ‡è¯†ï¼ˆslug æˆ– IDï¼‰
  â†“
ç”Ÿæˆ Merkle Tree
  â†“
è®°å½• Merkle Root
  â†“
éƒ¨ç½² MerkleDistributor åˆçº¦
  â†“
è½¬å…¥ä»£å¸åˆ°åˆçº¦
  â†“
é…ç½®å‰ç«¯åˆçº¦åœ°å€
  â†“
ç”¨æˆ·å¯ä»¥é¢†å–ä»£å¸
```

## ðŸ” ç•Œé¢é¢„è§ˆ

### ç®¡ç†åŽå°é¦–é¡µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸŽ Merkle Tree ç”Ÿæˆ              â”‚
â”‚  [ç”Ÿæˆ Merkle Tree]  [é‡‘è‰²æŒ‰é’®]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸ºç­¾åˆ°æ´»åŠ¨ç”Ÿæˆ Merkle Treeï¼Œ     â”‚
â”‚  ä½¿ç”¨æˆ·èƒ½å¤Ÿé¢†å–ä»£å¸ç©ºæŠ•           â”‚
â”‚                                  â”‚
â”‚  [æ‰“å¼€ç”Ÿæˆå·¥å…·] [æŸ¥çœ‹ä½¿ç”¨æŒ‡å—]    â”‚
â”‚                                  â”‚
â”‚  âš ï¸ é‡è¦æ­¥éª¤ï¼š                    â”‚
â”‚  1. ç¡®è®¤æ´»åŠ¨ç­¾åˆ°äººæ•°æ­£ç¡®          â”‚
â”‚  2. ç”Ÿæˆ Merkle Tree å¹¶è®°å½• Root â”‚
â”‚  3. éƒ¨ç½² MerkleDistributor åˆçº¦  â”‚
â”‚  4. å°†ä»£å¸è½¬å…¥åˆçº¦åœ°å€            â”‚
â”‚  5. åœ¨å‰ç«¯é…ç½®åˆçº¦åœ°å€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾§è¾¹æ å¯¼èˆª
```
â˜° å¯¼èˆªèœå•
â”œâ”€ è¿è¥ä¸­å¿ƒ
â”œâ”€ æ´»åŠ¨ç®¡ç†
â”œâ”€ å•†å“ä¸Šæž¶
â”œâ”€ åŒ äººç®¡ç†
â”œâ”€ è®¢å•ç®¡ç†
â”œâ”€ ðŸŒŸ Merkle Tree ç”Ÿæˆ [é‡‘è‰²è¾¹æ¡†]
â”œâ”€ ä¸ªäººä¸­å¿ƒ
â””â”€ é€€å‡ºç™»å½•
```

### Merkle ç”Ÿæˆé¡µé¢
```
ðŸŒ³ Merkle Tree ç”Ÿæˆå·¥å…·

æ­¥éª¤ 1ï¼šé€‰æ‹©æ´»åŠ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ´»åŠ¨ ID / Slug              â”‚
â”‚ [è¾“å…¥æ¡†: airdrop-2025]      â”‚
â”‚ [ðŸ“‹ åŠ è½½æ´»åŠ¨ä¿¡æ¯]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ´»åŠ¨ä¿¡æ¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ´»åŠ¨åç§°ï¼šç©ºæŠ•æ´»åŠ¨ 2025      â”‚
â”‚ æ´»åŠ¨ IDï¼š24                  â”‚
â”‚ ç­¾åˆ°äººæ•°ï¼š5                  â”‚
â”‚ Merkle çŠ¶æ€ï¼šå¾…ç”Ÿæˆ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤ 2ï¼šç”Ÿæˆ Merkle Tree
[ðŸš€ ç”Ÿæˆ Merkle Tree]

ç”Ÿæˆç»“æžœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ç”ŸæˆæˆåŠŸï¼                â”‚
â”‚                              â”‚
â”‚ æ´»åŠ¨ ID: 24                  â”‚
â”‚ Merkle Root: 0xabc123...     â”‚
â”‚ æ€»åœ°å€æ•°: 5                  â”‚
â”‚ æ€»ä»£å¸é‡: 5000... wei        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“Š API ç«¯ç‚¹

### ç”Ÿæˆ Merkle Tree
```
POST /admin/generate-merkle
Headers: 
  Authorization: Bearer {token}
  Content-Type: application/json
Body: 
  { "event_id": "airdrop-2025" }  // æ”¯æŒ slug æˆ–æ•°å­— ID

Response:
{
  "ok": true,
  "event_id": "24",
  "merkle_root": "0xabc123...",
  "total_addresses": 5,
  "total_amount": "5000000000000000000000"
}
```

### æŸ¥è¯¢é¢†å–èµ„æ ¼
```
GET /rewards/v2/eligibility/{slug}/{wallet}

Response:
{
  "ok": true,
  "eligible": true,
  "ready": true,
  "index": 0,
  "amount": "1000000000000000000000",
  "proof": ["0xabc...", "0xdef..."],
  "batch": "24"
}
```

## ðŸ› é—®é¢˜æŽ’æŸ¥

### é—®é¢˜ï¼šè®¿é—® /admin/merkle.html è·³è½¬å›žé¦–é¡µ

**åŽŸå› **ï¼š
- å¯èƒ½æœªç™»å½•
- Token è¿‡æœŸ

**è§£å†³**ï¼š
1. å…ˆè®¿é—® `/admin/` ç™»å½•
2. å†è®¿é—® Merkle ç”Ÿæˆé¡µé¢

### é—®é¢˜ï¼šç”Ÿæˆå¤±è´¥ï¼Œæç¤º 403

**åŽŸå› **ï¼šä¸æ˜¯ç®¡ç†å‘˜è´¦æˆ·

**è§£å†³**ï¼š
1. æ£€æŸ¥é’±åŒ…åœ°å€æ˜¯å¦åœ¨ `ADMIN_WALLETS` ä¸­
2. é‡æ–°ç™»å½•

### é—®é¢˜ï¼šç”Ÿæˆå¤±è´¥ï¼Œæç¤º "Event not found"

**åŽŸå› **ï¼šæ´»åŠ¨ä¸å­˜åœ¨

**è§£å†³**ï¼š
1. æ£€æŸ¥æ´»åŠ¨ slug æ˜¯å¦æ­£ç¡®
2. è®¿é—® `/api/events/get?slug=airdrop-2025` ç¡®è®¤æ´»åŠ¨å­˜åœ¨
3. å¦‚éœ€è¦ï¼Œåœ¨ç®¡ç†åŽå°åˆ›å»ºæ´»åŠ¨

### é—®é¢˜ï¼šç”Ÿæˆå¤±è´¥ï¼Œæç¤º "no checkins found"

**åŽŸå› **ï¼šè¯¥æ´»åŠ¨æ²¡æœ‰ç­¾åˆ°è®°å½•

**è§£å†³**ï¼š
1. ç¡®è®¤æœ‰ç”¨æˆ·å®Œæˆç­¾åˆ°
2. æ£€æŸ¥ event_id æ˜¯å¦åŒ¹é…

## ðŸ“ é‡è¦æç¤º

1. **Merkle Root å¾ˆé‡è¦**ï¼šç”ŸæˆåŽä¸€å®šè¦è®°å½•ï¼Œéƒ¨ç½²åˆçº¦æ—¶éœ€è¦
2. **åªèƒ½ç”Ÿæˆä¸€æ¬¡**ï¼šæ¯æ¬¡ç”Ÿæˆä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®
3. **éœ€è¦ç®¡ç†å‘˜æƒé™**ï¼šåªæœ‰é…ç½®çš„ç®¡ç†å‘˜é’±åŒ…æ‰èƒ½æ“ä½œ
4. **æ”¯æŒ Slug**ï¼šçŽ°åœ¨å¯ä»¥ä½¿ç”¨æ›´å‹å¥½çš„ slug è€Œä¸æ˜¯æ•°å­— ID

## ðŸŽ‰ çŽ°åœ¨å¯ä»¥ä½¿ç”¨äº†

1. âœ… ç®¡ç†åŽå°æœ‰æ˜Žæ˜¾çš„å…¥å£
2. âœ… Token è®¤è¯å·²ä¿®å¤
3. âœ… æ”¯æŒ slug è¾“å…¥
4. âœ… API å·²éƒ¨ç½²
5. âœ… å®Œæ•´çš„ä½¿ç”¨è¯´æ˜Ž

**ä¸‹ä¸€æ­¥**ï¼š
- ç™»å½•ç®¡ç†åŽå°
- ä¸º `airdrop-2025` æ´»åŠ¨ç”Ÿæˆ Merkle Tree
- è®°å½• Merkle Root
- éƒ¨ç½²åˆçº¦

---

**æ›´æ–°æ—¶é—´**ï¼š2025-10-27  
**éƒ¨ç½²çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**Worker ç‰ˆæœ¬**ï¼š9660e7e2-da38-4e55-9cc4-cf0f509fa600

