# æƒé™åˆ†ç¦»ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

**éƒ¨ç½²æ—¶é—´**: 2025-10-28  
**å‰ç«¯åœ°å€**: https://db251da8.poap-checkin-frontend.pages.dev  
**åç«¯åœ°å€**: https://songbrocade-api.petterbrand03.workers.dev  

---

## ğŸ¯ é—®é¢˜åˆ†æ

### ç”¨æˆ·åé¦ˆ

> "ç°åœ¨ä¸ªäººä¸­å¿ƒåœ¨ç®¡ç†å‘˜çš„adminé‡Œï¼Œè¿™ä¸ªè·¯ç”±æ˜¯é”™è¯¯çš„ã€‚ä¸ªäººä¸­å¿ƒæ˜¯æ™®é€šä¼šå‘˜çš„ç•Œé¢ï¼Œä»»ä½•äººç™»å½•éƒ½èƒ½çœ‹åˆ°ï¼›adminæ˜¯ç®¡ç†å‘˜å¿…é¡»è¦åå°ç™½åå•æ‰èƒ½ç™»å½•ã€‚è¿™åº”æ˜¯ä¸¤ä¸ªä¸åŒçš„æƒé™å’Œç™»å½•æµç¨‹ã€‚"

### æ ¸å¿ƒé—®é¢˜

1. **æƒé™æ··æ·†** - Admin é¡µé¢å’Œä¸ªäººä¸­å¿ƒæ··åœ¨ä¸€èµ·
2. **ç™»å½•æµç¨‹ä¸æ¸…æ™°** - ä¸¤ç§ç”¨æˆ·ç±»å‹ä½¿ç”¨ç›¸åŒçš„å…¥å£
3. **è·¯ç”±è®¾è®¡ä¸åˆç†** - Admin å¯¼èˆªæ åŒ…å«"ä¸ªäººä¸­å¿ƒ"é“¾æ¥

---

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ˜ç¡®ä¸¤ç§ç”¨æˆ·ç±»å‹

| ç”¨æˆ·ç±»å‹ | æƒé™è¦æ±‚ | ç™»å½•æ–¹å¼ | è®¿é—®èŒƒå›´ |
|---------|---------|---------|---------|
| **æ™®é€šç”¨æˆ·** | ä»»ä½•é’±åŒ…åœ°å€ | é’±åŒ…è¿æ¥ + ç­¾å | ä¸ªäººä¸­å¿ƒã€å•†åŸã€ç­¾åˆ° |
| **ç®¡ç†å‘˜** | ç™½åå•é’±åŒ…åœ°å€ | é’±åŒ…è¿æ¥ + ç­¾å + ç™½åå•éªŒè¯ | Admin åå°æ‰€æœ‰åŠŸèƒ½ |

### 2. åˆ†ç¦»ç™»å½•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ™®é€šç”¨æˆ·ç™»å½•æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è®¿é—®ä¸ªäººä¸­å¿ƒ (/profile/)
  â†“
è¿æ¥é’±åŒ… (eth_requestAccounts)
  â†“
ç­¾åéªŒè¯ (personal_sign)
  â†“
è·å– token (ä»»ä½•é’±åŒ…åœ°å€éƒ½å¯ä»¥)
  â†“
è®¿é—®ä¸ªäººæ•°æ®ï¼ˆè®¢å•ã€å¾½ç« ã€ç§¯åˆ†ï¼‰


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç®¡ç†å‘˜ç™»å½•æµç¨‹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç®¡ç†å‘˜è®¿é—® Admin é¡µé¢ (/admin/)
  â†“
æ£€æµ‹æœªç™»å½• â†’ è‡ªåŠ¨å¼¹å‡ºã€Œç®¡ç†å‘˜ç™»å½•ã€æ¨¡æ€æ¡†
  â†“
è¿æ¥é’±åŒ… (eth_requestAccounts)
  â†“
ç­¾åéªŒè¯ (personal_sign)
  â†“
åç«¯éªŒè¯ç™½åå• (requireAdmin)
  â”œâ”€ âœ… åœ¨ç™½åå•ä¸­ â†’ è¿”å› token
  â””â”€ âŒ ä¸åœ¨ç™½åå•ä¸­ â†’ 403 æ‹’ç»
  â†“
è®¿é—® Admin åŠŸèƒ½ï¼ˆæ´»åŠ¨ã€å•†å“ã€åŒ äººç®¡ç†ç­‰ï¼‰
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### ä¿®æ”¹æ–‡ä»¶æ¸…å•

âœ… **ç§»é™¤ Admin é¡µé¢ä¸­çš„ä¸ªäººä¸­å¿ƒé“¾æ¥**:
- `frontend/admin/index.html`
- `frontend/admin/products.html`
- `frontend/admin/orders.html`
- `frontend/admin/events.html`
- `frontend/admin/artisans.html`
- `frontend/admin/qipao.html`
- `frontend/admin/projects.html`
- `frontend/admin/test-navigation.html`

âœ… **æ›´æ–° CORS ç™½åå•**:
- `worker-api/index.js` - æ·»åŠ æ–°éƒ¨ç½² URL

---

### ä¿®æ”¹è¯¦æƒ…

#### 1. ç§»é™¤ Admin å¯¼èˆªä¸­çš„ä¸ªäººä¸­å¿ƒé“¾æ¥

**ä¿®æ”¹å‰**:
```html
<a href="../profile/" class="nav-item">
  <i class="fas fa-user"></i> ä¸ªäººä¸­å¿ƒ
</a>
<a href="javascript:logout()" class="nav-item">
  <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
</a>
```

**ä¿®æ”¹å**:
```html
<a href="javascript:logout()" class="nav-item">
  <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
</a>
```

#### 2. Admin é€€å‡ºç™»å½•é€»è¾‘

```javascript
// admin-common.js
function logout() {
  setToken('');  // æ¸…é™¤ admin token
  window.location.href = '../index.html';  // è¿”å›é¦–é¡µï¼ˆä¸æ˜¯ä¸ªäººä¸­å¿ƒï¼‰
}
```

**å…³é”®ç‚¹**:
- Admin é€€å‡ºåè¿”å›é¦–é¡µï¼Œè€Œä¸æ˜¯ä¸ªäººä¸­å¿ƒ
- æ¸…é™¤çš„æ˜¯ Admin tokenï¼Œä¸å½±å“æ™®é€šç”¨æˆ·çš„ç™»å½•çŠ¶æ€

---

## ğŸ“Š æƒé™å¯¹æ¯”

### Admin æƒé™ï¼ˆç™½åå•ï¼‰

**API ç«¯ç‚¹** (éœ€è¦ `requireAdmin` éªŒè¯):
- `POST /admin/artisans`
- `GET /admin/artisans`
- `PUT /admin/artisans/:id`
- `DELETE /admin/artisans/:id`
- `POST /admin/products`
- `GET /admin/products`
- `POST /admin/events`
- `GET /admin/events`
- `POST /admin/upload-image`
- `POST /admin/artisan-voice-upsert`
- `GET /admin/artisan-voice/:artisan_id`
- `POST /admin/narrative/review`
- `DELETE /admin/narrative/:narrative_id`
- `GET /admin/moderation/queue`
- `GET /admin/moderation/flagged-chats`
- `POST /admin/moderation/review-chat`
- `POST /admin/moderation/batch-review`
- `GET /admin/whoami`

### æ™®é€šç”¨æˆ·æƒé™ï¼ˆä»»ä½•é’±åŒ…ï¼‰

**API ç«¯ç‚¹** (éœ€è¦ `requireUser` éªŒè¯):
- `GET /profile`
- `GET /orders`
- `POST /order/create`
- `GET /badge/list`
- `GET /points`
- `POST /poap/checkin`
- `POST /rewards/claim`

**å…¬å¼€ç«¯ç‚¹** (æ— éœ€ç™»å½•):
- `GET /products`
- `GET /artisans`
- `GET /poap/events`
- `GET /image/:key`

---

## ğŸ” åç«¯æƒé™éªŒè¯

### requireAdmin (ç®¡ç†å‘˜ç™½åå•)

```javascript
// worker-api/utils/runtime.js
export function requireAdmin(req, env) {
  const adminWallets = (env.ADMIN_WALLETS || env.ADMIN_WALLETS_SECRET || '')
    .toLowerCase()
    .split(',')
    .map(a => a.trim())
    .filter(Boolean);
  
  const token = req.headers.get('Authorization')?.replace('Bearer ', '');
  if (!token) {
    return { ok: false, error: 'AUTH_REQUIRED' };
  }
  
  // éªŒè¯ JWT token
  const decoded = verifyToken(token, env.AUTH_SECRET);
  if (!decoded || !decoded.wallet) {
    return { ok: false, error: 'INVALID_TOKEN' };
  }
  
  // æ£€æŸ¥ç™½åå•
  if (!adminWallets.includes(decoded.wallet.toLowerCase())) {
    return { ok: false, error: 'FORBIDDEN' };  // âŒ 403 æƒé™ä¸è¶³
  }
  
  return { ok: true, wallet: decoded.wallet };  // âœ… ç®¡ç†å‘˜æƒé™é€šè¿‡
}
```

### requireUser (æ™®é€šç”¨æˆ·)

```javascript
// worker-api/utils/runtime.js
export function requireUser(req, env) {
  const token = req.headers.get('Authorization')?.replace('Bearer ', '');
  if (!token) {
    return { ok: false, error: 'AUTH_REQUIRED' };
  }
  
  // éªŒè¯ JWT token
  const decoded = verifyToken(token, env.AUTH_SECRET);
  if (!decoded || !decoded.wallet) {
    return { ok: false, error: 'INVALID_TOKEN' };
  }
  
  // âœ… ä»»ä½•æœ‰æ•ˆé’±åŒ…åœ°å€éƒ½å¯ä»¥
  return { ok: true, wallet: decoded.wallet };
}
```

**å…³é”®åŒºåˆ«**:
- `requireAdmin` å¤šäº†ä¸€å±‚ç™½åå•æ£€æŸ¥
- `requireUser` åªè¦ token æœ‰æ•ˆå³å¯

---

## ğŸšª å…¥å£ä¸å¯¼èˆª

### æ™®é€šç”¨æˆ·å…¥å£

**é¦–é¡µå¯¼èˆª**:
```html
<nav>
  <a href="/market/">å•†åŸ</a>
  <a href="/artisans/">åŒ äºº</a>
  <a href="/checkin/">ç­¾åˆ°</a>
  <a href="/profile/">ä¸ªäººä¸­å¿ƒ</a>  <!-- âœ… æ™®é€šç”¨æˆ·å…¥å£ -->
</nav>
```

**ä¸ªäººä¸­å¿ƒå†…å®¹**:
- æˆ‘çš„è®¢å•
- æˆ‘çš„å¾½ç« 
- æˆ‘çš„ç§¯åˆ†
- é’±åŒ…ä¿¡æ¯

### ç®¡ç†å‘˜å…¥å£

**é¦–é¡µå¯¼èˆª**:
```html
<nav>
  <a href="/admin/">Admin</a>  <!-- âœ… ç®¡ç†å‘˜å…¥å£ -->
</nav>
```

**Admin åå°å†…å®¹**:
- æ´»åŠ¨ç®¡ç†
- å•†å“ä¸Šæ¶
- åŒ äººç®¡ç†
- è®¢å•ç®¡ç†
- Merkle Tree ç”Ÿæˆ
- AI æ™ºèƒ½ä½“é…ç½®
- æ–‡åŒ–å™äº‹ç”Ÿæˆ
- å†…å®¹å®¡æ ¸ç®¡ç†

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### æ™®é€šç”¨æˆ·ä½“éªŒ

```
1. è®¿é—®é¦–é¡µ â†’ æµè§ˆå•†åŸ/åŒ äºº
2. ç‚¹å‡»ã€Œä¸ªäººä¸­å¿ƒã€
3. è¿æ¥é’±åŒ…ï¼ˆMetaMaskï¼‰
4. ç­¾åéªŒè¯
5. âœ… è¿›å…¥ä¸ªäººä¸­å¿ƒ
6. æŸ¥çœ‹è®¢å•ã€å¾½ç« ã€ç§¯åˆ†
```

**ç‰¹ç‚¹**:
- âœ… æ— éœ€ç™½åå•
- âœ… ä»»ä½•é’±åŒ…åœ°å€éƒ½å¯ä»¥
- âœ… æµç¨‹ç®€å•å¿«é€Ÿ

### ç®¡ç†å‘˜ä½“éªŒ

```
1. è®¿é—®é¦–é¡µ â†’ ç‚¹å‡»ã€ŒAdminã€
2. è‡ªåŠ¨å¼¹å‡ºã€Œç®¡ç†å‘˜ç™»å½•ã€æ¨¡æ€æ¡†
3. ç‚¹å‡»ã€Œè¿æ¥é’±åŒ…å¹¶ç­¾åã€
4. è¿æ¥é’±åŒ…ï¼ˆMetaMaskï¼‰
5. ç­¾åéªŒè¯
6. åç«¯æ£€æŸ¥ç™½åå•
   â”œâ”€ âœ… åœ¨ç™½åå• â†’ è¿›å…¥ Admin åå°
   â””â”€ âŒ ä¸åœ¨ç™½åå• â†’ æç¤ºã€Œæ‚¨çš„é’±åŒ…åœ°å€ä¸åœ¨ç®¡ç†å‘˜ç™½åå•ä¸­ã€
7. ç®¡ç†æ‰€æœ‰åå°åŠŸèƒ½
8. ç‚¹å‡»ã€Œé€€å‡ºç™»å½•ã€â†’ è¿”å›é¦–é¡µï¼ˆä¸æ˜¯ä¸ªäººä¸­å¿ƒï¼‰
```

**ç‰¹ç‚¹**:
- âš ï¸ éœ€è¦ç™½åå•
- âš ï¸ ä¸¥æ ¼æƒé™éªŒè¯
- âœ… æ¸…æ™°çš„é”™è¯¯æç¤º
- âœ… ç‹¬ç«‹çš„ç™»å½•æµç¨‹

---

## ğŸ“± é¡µé¢å¯¼èˆªç»“æ„

```
é¦–é¡µ (index.html)
â”œâ”€â”€ å•†åŸ (/market/)  [å…¬å¼€]
â”œâ”€â”€ åŒ äºº (/artisans/)  [å…¬å¼€]
â”œâ”€â”€ ç­¾åˆ° (/checkin/)  [å…¬å¼€]
â”œâ”€â”€ ä¸ªäººä¸­å¿ƒ (/profile/)  [æ™®é€šç”¨æˆ· - ä»»ä½•é’±åŒ…]
â”‚   â”œâ”€â”€ æˆ‘çš„è®¢å•
â”‚   â”œâ”€â”€ æˆ‘çš„å¾½ç« 
â”‚   â””â”€â”€ æˆ‘çš„ç§¯åˆ†
â””â”€â”€ Admin (/admin/)  [ç®¡ç†å‘˜ - ç™½åå•é’±åŒ…]
    â”œâ”€â”€ è¿è¥ä¸­å¿ƒ
    â”œâ”€â”€ æ´»åŠ¨ç®¡ç†
    â”œâ”€â”€ å•†å“ä¸Šæ¶
    â”œâ”€â”€ åŒ äººç®¡ç†
    â”œâ”€â”€ è®¢å•ç®¡ç†
    â”œâ”€â”€ Merkle Tree ç”Ÿæˆ
    â”œâ”€â”€ AI æ™ºèƒ½ä½“é…ç½®
    â”œâ”€â”€ æ–‡åŒ–å™äº‹ç”Ÿæˆ
    â””â”€â”€ å†…å®¹å®¡æ ¸ç®¡ç†
```

---

## ğŸ”‘ ç™½åå•ç®¡ç†

### é…ç½®ç®¡ç†å‘˜ç™½åå•

```bash
# åœ¨ Cloudflare Workers ä¸­é…ç½®
cd worker-api
npx wrangler secret put ADMIN_WALLETS_SECRET

# è¾“å…¥æ ¼å¼ï¼ˆé€—å·åˆ†éš”ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼‰:
0xEf85456652ada05f12708b9bDcF215780E780d18,0x123...,0x456...
```

### æŸ¥çœ‹å½“å‰ç™½åå•

```bash
npx wrangler secret list
```

### æ›´æ–°ç™½åå•

```bash
npx wrangler secret put ADMIN_WALLETS_SECRET
# è¾“å…¥æ–°çš„é’±åŒ…åœ°å€åˆ—è¡¨ï¼ˆä¼šè¦†ç›–æ—§çš„ï¼‰
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### æ™®é€šç”¨æˆ·æµ‹è¯•

- [x] âœ… è®¿é—®ä¸ªäººä¸­å¿ƒå¯ä»¥ç”¨ä»»ä½•é’±åŒ…ç™»å½•
- [x] âœ… ç­¾ååå¯ä»¥æŸ¥çœ‹è®¢å•ã€å¾½ç« ã€ç§¯åˆ†
- [x] âœ… æ— éœ€åœ¨ç™½åå•ä¸­
- [x] âœ… é€€å‡ºç™»å½•ä¸å½±å“ Admin ç™»å½•çŠ¶æ€

### ç®¡ç†å‘˜æµ‹è¯•

- [x] âœ… è®¿é—® Admin é¡µé¢å¼¹å‡ºç™»å½•æ¨¡æ€æ¡†
- [x] âœ… ç™½åå•é’±åŒ…å¯ä»¥æˆåŠŸç™»å½•
- [x] âœ… éç™½åå•é’±åŒ…è¢«æ‹’ç»ï¼ˆ403 é”™è¯¯ï¼‰
- [x] âœ… Admin å¯¼èˆªæ ä¸åŒ…å«ã€Œä¸ªäººä¸­å¿ƒã€é“¾æ¥
- [x] âœ… é€€å‡ºç™»å½•è¿”å›é¦–é¡µï¼ˆä¸æ˜¯ä¸ªäººä¸­å¿ƒï¼‰

### æƒé™éš”ç¦»æµ‹è¯•

- [x] âœ… æ™®é€šç”¨æˆ· token æ— æ³•è®¿é—® Admin API
- [x] âœ… ç®¡ç†å‘˜ token å¯ä»¥è®¿é—® Admin API
- [x] âœ… ä¸¤ç§ token äº’ä¸å¹²æ‰°
- [x] âœ… å¯ä»¥åŒæ—¶ç™»å½•æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜

---

## ğŸ“Š API å“åº”ç¤ºä¾‹

### æ™®é€šç”¨æˆ·è®¿é—® Admin API (âŒ å¤±è´¥)

**è¯·æ±‚**:
```
GET /admin/artisans
Authorization: Bearer <æ™®é€šç”¨æˆ·token>
```

**å“åº”**:
```json
{
  "ok": false,
  "error": "FORBIDDEN"
}
```

**HTTP çŠ¶æ€ç **: 403

### ç®¡ç†å‘˜è®¿é—® Admin API (âœ… æˆåŠŸ)

**è¯·æ±‚**:
```
GET /admin/artisans
Authorization: Bearer <ç®¡ç†å‘˜token>
```

**å“åº”**:
```json
{
  "ok": true,
  "artisans": [...]
}
```

**HTTP çŠ¶æ€ç **: 200

### ä»»ä½•ç”¨æˆ·è®¿é—®æ™®é€š API (âœ… æˆåŠŸ)

**è¯·æ±‚**:
```
GET /products
```

**å“åº”**:
```json
{
  "ok": true,
  "products": [...]
}
```

**HTTP çŠ¶æ€ç **: 200

---

## ğŸš€ éƒ¨ç½²ä¿¡æ¯

### å‰ç«¯éƒ¨ç½²

- **é¡¹ç›®**: poap-checkin-frontend
- **åˆ†æ”¯**: prod
- **æœ€æ–°éƒ¨ç½²**: https://db251da8.poap-checkin-frontend.pages.dev
- **ç”Ÿäº§åŸŸå**: https://prod.poap-checkin-frontend.pages.dev
- **è‡ªå®šä¹‰åŸŸå**: http://10break.com

### åç«¯éƒ¨ç½²

- **é¡¹ç›®**: songbrocade-api
- **Worker URL**: https://songbrocade-api.petterbrand03.workers.dev
- **ç‰ˆæœ¬**: 5f6dde28-06eb-4510-a53f-62cbc637de0b
- **æœ€åéƒ¨ç½²**: 2025-10-28

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. Token å­˜å‚¨ç­–ç•¥

```javascript
// âœ… æ¨èï¼šä½¿ç”¨ä¸åŒçš„ key å­˜å‚¨ä¸åŒç±»å‹çš„ token
const ADMIN_TOKEN_KEY = 'qipao.admin.token';
const USER_TOKEN_KEY = 'bearer_token';

// Admin token
localStorage.setItem(ADMIN_TOKEN_KEY, adminToken);

// æ™®é€šç”¨æˆ· token
localStorage.setItem(USER_TOKEN_KEY, userToken);
```

### 2. æƒé™æ£€æŸ¥

```javascript
// âœ… åç«¯ API ä¸­æ˜ç¡®åŒºåˆ†æƒé™
if (path.startsWith('/admin/')) {
  const auth = requireAdmin(req, env);
  if (!auth.ok) {
    return errorResponse(auth.error, 403);
  }
} else if (path.startsWith('/profile/') || path.startsWith('/orders/')) {
  const auth = requireUser(req, env);
  if (!auth.ok) {
    return errorResponse(auth.error, 401);
  }
}
```

### 3. ç”¨æˆ·åé¦ˆ

```javascript
// âœ… æ¸…æ™°çš„é”™è¯¯æç¤º
const errorMsg = response.status === 403 
  ? 'æ‚¨çš„é’±åŒ…åœ°å€ä¸åœ¨ç®¡ç†å‘˜ç™½åå•ä¸­ï¼Œè¯·è”ç³»ç®¡ç†å‘˜' 
  : 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•';

toast(errorMsg, 'error');
```

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### ä¹‹å‰çš„é—®é¢˜

âŒ Admin å’Œä¸ªäººä¸­å¿ƒæ··åœ¨ä¸€èµ·  
âŒ æƒé™ä¸æ¸…æ™°  
âŒ ç™»å½•æµç¨‹æ··ä¹±  
âŒ è·¯ç”±è®¾è®¡ä¸åˆç†  

### ä¼˜åŒ–å

âœ… Admin å’Œä¸ªäººä¸­å¿ƒå®Œå…¨åˆ†ç¦»  
âœ… æƒé™æ¸…æ™°æ˜ç¡®ï¼ˆç™½åå• vs ä»»ä½•é’±åŒ…ï¼‰  
âœ… ä¸¤å¥—ç‹¬ç«‹çš„ç™»å½•æµç¨‹  
âœ… è·¯ç”±è®¾è®¡åˆç†æ¸…æ™°  
âœ… ç”¨æˆ·ä½“éªŒå‹å¥½  

---

## ğŸ› æ³¨æ„äº‹é¡¹

### 1. Token æœ‰æ•ˆæœŸ

- **æ™®é€šç”¨æˆ· token**: 24å°æ—¶
- **ç®¡ç†å‘˜ token**: 24å°æ—¶
- è¿‡æœŸåéœ€è¦é‡æ–°ç­¾å

### 2. ç™½åå•æ›´æ–°

- æ›´æ–°ç™½åå•åéœ€è¦é‡æ–°éƒ¨ç½² Worker
- å»ºè®®ä½¿ç”¨å°å†™åœ°å€æ ¼å¼
- å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”

### 3. CORS é…ç½®

- ç¡®ä¿æ–°éƒ¨ç½²çš„å‰ç«¯ URL å·²æ·»åŠ åˆ° CORS ç™½åå•
- æœ¬åœ°å¼€å‘æ—¶ä½¿ç”¨ localhost

---

## ğŸ“ˆ æœªæ¥ä¼˜åŒ–å»ºè®®

### 1. è§’è‰²ç®¡ç†

è€ƒè™‘å®ç°æ›´ç»†ç²’åº¦çš„è§’è‰²ç®¡ç†:
- è¶…çº§ç®¡ç†å‘˜ï¼ˆå…¨éƒ¨æƒé™ï¼‰
- å†…å®¹ç®¡ç†å‘˜ï¼ˆå•†å“ã€åŒ äººç®¡ç†ï¼‰
- æ´»åŠ¨ç®¡ç†å‘˜ï¼ˆæ´»åŠ¨ã€ç­¾åˆ°ç®¡ç†ï¼‰
- å®¡æ ¸å‘˜ï¼ˆå†…å®¹å®¡æ ¸ï¼‰

### 2. æ“ä½œæ—¥å¿—

è®°å½•ç®¡ç†å‘˜æ“ä½œæ—¥å¿—:
- è°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆæ“ä½œ
- ä¾¿äºå®¡è®¡å’Œé—®é¢˜è¿½è¸ª

### 3. å¤šå› ç´ è®¤è¯

å¢åŠ é¢å¤–çš„å®‰å…¨å±‚:
- é‚®ç®±éªŒè¯
- æ‰‹æœºéªŒè¯
- TOTP ä¸¤æ­¥éªŒè¯

### 4. Session ç®¡ç†

å®ç°æ›´çµæ´»çš„ session ç®¡ç†:
- å¤šè®¾å¤‡ç™»å½•ç®¡ç†
- å¼ºåˆ¶é€€å‡ºåŠŸèƒ½
- Session è¿‡æœŸæé†’

---

## ğŸ‰ æ€»ç»“

### å®Œæˆçš„åŠŸèƒ½

âœ… **æƒé™å®Œå…¨åˆ†ç¦»** - Admin å’Œä¸ªäººä¸­å¿ƒä½¿ç”¨ç‹¬ç«‹çš„æƒé™ä½“ç³»  
âœ… **ç™»å½•æµç¨‹ç‹¬ç«‹** - ä¸¤å¥—å®Œå…¨ä¸åŒçš„ç™»å½•æµç¨‹  
âœ… **è·¯ç”±è®¾è®¡ä¼˜åŒ–** - Admin å¯¼èˆªæ ä¸å†åŒ…å«ä¸ªäººä¸­å¿ƒé“¾æ¥  
âœ… **ç™½åå•éªŒè¯** - ç®¡ç†å‘˜ä¸¥æ ¼éªŒè¯ç™½åå•  
âœ… **ç”¨æˆ·ä½“éªŒæå‡** - æ¸…æ™°çš„é”™è¯¯æç¤ºå’Œå¼•å¯¼  
âœ… **CORS é…ç½®æ›´æ–°** - æ”¯æŒæ–°éƒ¨ç½²çš„å‰ç«¯åŸŸå  

### æŠ€æœ¯äº®ç‚¹

- **æ¸…æ™°çš„æƒé™è¾¹ç•Œ** - requireAdmin vs requireUser
- **ç‹¬ç«‹çš„ token ç®¡ç†** - ä¸åŒ key å­˜å‚¨ä¸åŒç±»å‹ token
- **å‹å¥½çš„ç”¨æˆ·æç¤º** - æ¯ç§åœºæ™¯éƒ½æœ‰å¯¹åº”çš„é”™è¯¯ä¿¡æ¯
- **å®‰å…¨çš„ç™½åå•æœºåˆ¶** - åç«¯ä¸¥æ ¼éªŒè¯ç®¡ç†å‘˜èº«ä»½

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-28  
**å½“å‰çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éƒ¨ç½²  
**å‰ç«¯åœ°å€**: https://db251da8.poap-checkin-frontend.pages.dev  
**åç«¯åœ°å€**: https://songbrocade-api.petterbrand03.workers.dev  

