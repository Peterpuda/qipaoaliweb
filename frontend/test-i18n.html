<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>i18n æµ‹è¯•é¡µé¢</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .success {
      background: #d4edda;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #007bff;
      color: white;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª i18n ç³»ç»Ÿæµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>1. åŸºç¡€æµ‹è¯•</h2>
    <div id="basicTests"></div>
  </div>
  
  <div class="test-section">
    <h2>2. ç¿»è¯‘æµ‹è¯•</h2>
    <p data-i18n="common.home">é¦–é¡µ</p>
    <p data-i18n="homepage.title">å…¨çƒæ——è¢æ–‡åŒ–å…±å»ºç¤¾åŒº</p>
    <p data-i18n="homepage.nav.platform">å¹³å°</p>
    <button onclick="testTranslation()">æµ‹è¯•ç¿»è¯‘</button>
    <div id="translationTests"></div>
  </div>
  
  <div class="test-section">
    <h2>3. è¯­è¨€åˆ‡æ¢æµ‹è¯•</h2>
    <button onclick="switchLanguage('zh')">ä¸­æ–‡</button>
    <button onclick="switchLanguage('en')">English</button>
    <button onclick="switchLanguage('ja')">æ—¥æœ¬èª</button>
    <div id="languageTests"></div>
  </div>
  
  <div class="test-section">
    <h2>4. æ§åˆ¶å°æ—¥å¿—</h2>
    <div id="consoleLogs" style="background: #f8f9fa; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto;"></div>
  </div>

  <!-- åŠ è½½ i18n å¼•æ“ -->
  <script src="/i18n/index.js"></script>
  <script src="/common/i18n-helper.js"></script>
  
  <script>
    // æ•è·æ§åˆ¶å°æ—¥å¿—
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    const logsDiv = document.getElementById('consoleLogs');
    
    function addLog(type, ...args) {
      const logEntry = document.createElement('div');
      logEntry.style.marginBottom = '5px';
      logEntry.style.color = type === 'error' ? '#dc3545' : type === 'warn' ? '#ffc107' : '#28a745';
      logEntry.textContent = `[${type.toUpperCase()}] ${args.join(' ')}`;
      logsDiv.appendChild(logEntry);
      logsDiv.scrollTop = logsDiv.scrollHeight;
    }
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      addLog('log', ...args);
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      addLog('error', ...args);
    };
    
    console.warn = function(...args) {
      originalWarn.apply(console, args);
      addLog('warn', ...args);
    };
    
    // åŸºç¡€æµ‹è¯•
    function runBasicTests() {
      const results = [];
      const div = document.getElementById('basicTests');
      
      // æµ‹è¯• 1: window.i18n æ˜¯å¦å­˜åœ¨
      results.push({
        test: 'window.i18n å­˜åœ¨',
        pass: typeof window.i18n !== 'undefined',
        value: typeof window.i18n
      });
      
      // æµ‹è¯• 2: window.t æ˜¯å¦å­˜åœ¨
      results.push({
        test: 'window.t å­˜åœ¨',
        pass: typeof window.t === 'function',
        value: typeof window.t
      });
      
      // æµ‹è¯• 3: i18n.locale
      results.push({
        test: 'å½“å‰è¯­è¨€',
        pass: window.i18n && window.i18n.locale,
        value: window.i18n ? window.i18n.locale : 'undefined'
      });
      
      // æµ‹è¯• 4: å·²åŠ è½½çš„è¯­è¨€
      results.push({
        test: 'å·²åŠ è½½è¯­è¨€',
        pass: window.i18n && window.i18n.loadedLanguages.length > 0,
        value: window.i18n ? window.i18n.loadedLanguages.join(', ') : 'none'
      });
      
      // æµ‹è¯• 5: è¯­è¨€åŒ…æ•°æ®
      results.push({
        test: 'è¯­è¨€åŒ…æ•°æ®',
        pass: window.i18n && Object.keys(window.i18n.messages).length > 0,
        value: window.i18n ? Object.keys(window.i18n.messages).join(', ') : 'none'
      });
      
      // æ˜¾ç¤ºç»“æœ
      div.innerHTML = results.map(r => `
        <div class="test-result ${r.pass ? 'success' : 'error'}">
          ${r.pass ? 'âœ…' : 'âŒ'} ${r.test}: <strong>${r.value}</strong>
        </div>
      `).join('');
    }
    
    // ç¿»è¯‘æµ‹è¯•
    function testTranslation() {
      const div = document.getElementById('translationTests');
      const tests = [
        'common.home',
        'homepage.title',
        'homepage.nav.platform',
        'homepage.nav.token',
        'homepage.hero.title'
      ];
      
      const results = tests.map(key => {
        const translation = window.t ? window.t(key) : 'window.t not found';
        return {
          key,
          translation,
          pass: translation !== key
        };
      });
      
      div.innerHTML = results.map(r => `
        <div class="test-result ${r.pass ? 'success' : 'error'}">
          ${r.pass ? 'âœ…' : 'âŒ'} <code>${r.key}</code> â†’ "${r.translation}"
        </div>
      `).join('');
      
      // è§¦å‘é¡µé¢ç¿»è¯‘
      if (window.translatePage) {
        window.translatePage();
      }
    }
    
    // è¯­è¨€åˆ‡æ¢æµ‹è¯•
    async function switchLanguage(locale) {
      const div = document.getElementById('languageTests');
      div.innerHTML = `<p>æ­£åœ¨åˆ‡æ¢åˆ° ${locale}...</p>`;
      
      try {
        if (window.i18n && window.i18n.setLocale) {
          await window.i18n.setLocale(locale);
          if (window.translatePage) {
            window.translatePage();
          }
          div.innerHTML = `<div class="test-result success">âœ… æˆåŠŸåˆ‡æ¢åˆ° ${locale}</div>`;
          runBasicTests();
          testTranslation();
        } else {
          div.innerHTML = `<div class="test-result error">âŒ i18n.setLocale ä¸å­˜åœ¨</div>`;
        }
      } catch (error) {
        div.innerHTML = `<div class="test-result error">âŒ åˆ‡æ¢å¤±è´¥: ${error.message}</div>`;
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
    window.addEventListener('DOMContentLoaded', async () => {
      console.log('ğŸ§ª å¼€å§‹ i18n æµ‹è¯•...');
      
      // ç­‰å¾… i18n åˆå§‹åŒ–
      if (window.i18n) {
        try {
          await window.i18n.init('zh');
          console.log('âœ… i18n åˆå§‹åŒ–å®Œæˆ');
        } catch (error) {
          console.error('âŒ i18n åˆå§‹åŒ–å¤±è´¥:', error);
        }
      }
      
      // è¿è¡ŒåŸºç¡€æµ‹è¯•
      runBasicTests();
      
      // è¿è¡Œç¿»è¯‘æµ‹è¯•
      testTranslation();
    });
  </script>
</body>
</html>

