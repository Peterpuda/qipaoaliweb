# å•†å“è¯¦æƒ…é¡µä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1ï¼šæ–‡åŒ–æ•…äº‹æœªæ˜¾ç¤º âŒ
**åŸå› **ï¼šå‰ç«¯æŸ¥è¯¢ `status=all`ï¼Œä½†æ•°æ®åº“ä¸­çš„æ•…äº‹çŠ¶æ€æ˜¯ `draft`ï¼Œç”¨æˆ·ç«¯åº”è¯¥åªçœ‹åˆ° `published` çŠ¶æ€çš„å†…å®¹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… ä¿®æ”¹å‰ç«¯æŸ¥è¯¢å‚æ•°ä» `status=all` æ”¹ä¸º `status=published`
- âœ… ç®¡ç†å‘˜éœ€è¦åœ¨åå°ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®ï¼Œå°†æ•…äº‹çŠ¶æ€ä» `draft` æ”¹ä¸º `published`

### é—®é¢˜ 2ï¼šåŒ äºº ID ä¸åŒ¹é… âš ï¸
**åŸå› **ï¼šå•†å“è¡¨ä¸­çš„ `artisan_id` æ ¼å¼ä¸æ­£ç¡®
- å•†å“ä¸­å­˜å‚¨çš„ï¼š`id_19a4336d63b_c74496ea472f2`
- åŒ äººè¡¨ä¸­çš„ IDï¼š`artisan_001`, `artisan_003`, `artisan_004`, ...

**è§£å†³æ–¹æ¡ˆ**ï¼š
éœ€è¦åœ¨åå°å•†å“ç®¡ç†é¡µé¢ä¿®æ”¹å•†å“çš„ `artisan_id`ï¼Œé€‰æ‹©æ­£ç¡®çš„åŒ äºº IDã€‚

### é—®é¢˜ 3ï¼šéŸ³é¢‘é“¾æ¥è·³è½¬å›ä¸»é¡µ âœ…
**åŸå› **ï¼šå·²ä¿®å¤ï¼ˆadmin é¡µé¢çš„ç›¸å¯¹è·¯å¾„é—®é¢˜ï¼‰

**éŸ³é¢‘ URL æ ¼å¼**ï¼š`/r2/narratives/audio/${narrativeId}.mp3`

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. å‰ç«¯æŸ¥è¯¢å‚æ•°ä¿®æ”¹
```javascript
// âŒ æ—§ä»£ç ï¼šæŸ¥è¯¢æ‰€æœ‰çŠ¶æ€
const response = await fetch(`${API_BASE}/ai/narrative/product/${productId}?status=all`);

// âœ… æ–°ä»£ç ï¼šåªæŸ¥è¯¢å·²å‘å¸ƒçš„å†…å®¹
const response = await fetch(`${API_BASE}/ai/narrative/product/${productId}?status=published`);
```

### 2. Admin é¡µé¢éŸ³é¢‘/è§†é¢‘é“¾æ¥ä¿®å¤
```javascript
// âœ… ç¡®ä¿ URL æ˜¯å®Œæ•´çš„ç»å¯¹è·¯å¾„
const audioUrl = narrative.audio_url.startsWith('http') 
    ? narrative.audio_url 
    : `${ADMIN_CONFIG.API_BASE}${narrative.audio_url}`;
```

### 3. è¯¦ç»†æ—¥å¿—è¾“å‡º
- âœ… å‰ç«¯ï¼šæ˜¾ç¤º product_idã€API URLã€å“åº”çŠ¶æ€
- âœ… åç«¯ï¼šæ˜¾ç¤ºæŸ¥è¯¢å‚æ•°ã€æ‰¾åˆ°çš„æ•…äº‹æ•°é‡
- âœ… åŒ äººåŠ è½½ï¼šæ˜¾ç¤º artisan_idã€å¯ç”¨çš„åŒ äººåˆ—è¡¨

---

## ğŸ“‹ æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šå‘å¸ƒæ–‡åŒ–æ•…äº‹
1. è®¿é—® `/admin/narrative-generator.html`
2. æ‰¾åˆ°å·²ç”Ÿæˆçš„æ–‡åŒ–æ•…äº‹ï¼ˆçŠ¶æ€ä¸º `draft`ï¼‰
3. ç‚¹å‡»"âœ… å‘å¸ƒ"æŒ‰é’®
4. ç¡®è®¤çŠ¶æ€å˜ä¸º `published`

### æ­¥éª¤ 2ï¼šæµ‹è¯•å•†å“è¯¦æƒ…é¡µ
1. å¼ºåˆ¶åˆ·æ–°å•†å“è¯¦æƒ…é¡µï¼ˆCmd/Ctrl + Shift + Rï¼‰
2. ç‚¹å‡»"äº†è§£æ–‡åŒ–æ•…äº‹"æŒ‰é’®
3. åº”è¯¥èƒ½çœ‹åˆ°å·²å‘å¸ƒçš„æ–‡åŒ–æ•…äº‹
4. åˆ‡æ¢åˆ°"ğŸµ è¯­éŸ³"æ ‡ç­¾
5. ç‚¹å‡»æ’­æ”¾ï¼Œåº”è¯¥èƒ½æ­£å¸¸æ’­æ”¾éŸ³é¢‘

### æ­¥éª¤ 3ï¼šä¿®å¤åŒ äºº ID
1. è®¿é—® `/admin/products.html`
2. ç¼–è¾‘å•†å“
3. åœ¨"åŒ äºº ID"å­—æ®µä¸­ï¼Œé€‰æ‹©æ­£ç¡®çš„åŒ äºº IDï¼ˆå¦‚ `artisan_001`ï¼‰
4. ä¿å­˜å•†å“
5. åˆ·æ–°å•†å“è¯¦æƒ…é¡µ
6. åº”è¯¥èƒ½çœ‹åˆ°æ­£ç¡®çš„åŒ äººä¿¡æ¯å’Œ"ä¸åŒ äººå¯¹è¯"åŠŸèƒ½

---

## ğŸ§ª æ§åˆ¶å°æ—¥å¿—ç¤ºä¾‹

### âœ… æˆåŠŸåŠ è½½æ–‡åŒ–æ•…äº‹
```
ğŸ“– Loading cultural narratives for product: id_19a28fd0a18_47a42e7525ca5
ğŸ“– API URL: .../ai/narrative/product/id_19a28fd0a18_47a42e7525ca5?status=published
ğŸ“– Response status: 200
ğŸ“– Response data: { ok: true, narratives: Array(1), total: 1 }
âœ… Found 1 narratives
```

### âœ… æˆåŠŸåŠ è½½åŒ äººä¿¡æ¯
```
ğŸ‘¤ Loading artisan info, artisan_id: artisan_001
ğŸ‘¤ Fetched 14 artisans from API
âœ… Found artisan: ææ˜ (ID: artisan_001)
```

### âš ï¸ åŒ äºº ID ä¸åŒ¹é…ï¼ˆéœ€è¦ä¿®å¤ï¼‰
```
ğŸ‘¤ Loading artisan info, artisan_id: id_19a4336d63b_c74496ea472f2
ğŸ‘¤ Fetched 14 artisans from API
âš ï¸ Artisan not found with ID: id_19a4336d63b_c74496ea472f2
Available artisan IDs: artisan_001, artisan_003, artisan_004, ...
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ

### ç«‹å³æ“ä½œï¼ˆå¿…é¡»ï¼‰
1. âœ… **å‘å¸ƒæ–‡åŒ–æ•…äº‹**ï¼šåœ¨ admin é¡µé¢ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®
2. âš ï¸ **ä¿®å¤åŒ äºº ID**ï¼šåœ¨å•†å“ç®¡ç†é¡µé¢ä¿®æ”¹ä¸ºæ­£ç¡®çš„åŒ äºº ID

### æ•°æ®ä¿®å¤ï¼ˆå¯é€‰ï¼‰
å¦‚æœæœ‰å¤šä¸ªå•†å“çš„åŒ äºº ID æ ¼å¼ä¸æ­£ç¡®ï¼Œå¯ä»¥ï¼š
1. æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰å•†å“çš„ `artisan_id`
2. æ‰¾å‡ºæ ¼å¼ä¸æ­£ç¡®çš„ï¼ˆä¸æ˜¯ `artisan_XXX` æ ¼å¼ï¼‰
3. æ‰¹é‡æ›´æ–°ä¸ºæ­£ç¡®çš„åŒ äºº ID

---

## ğŸ“Š éƒ¨ç½²çŠ¶æ€

- **å‰ç«¯**ï¼šâœ… å·²éƒ¨ç½²ï¼ˆä¿®å¤æŸ¥è¯¢å‚æ•°ï¼‰
- **åç«¯**ï¼šâœ… å·²éƒ¨ç½²ï¼ˆæ·»åŠ è¯¦ç»†æ—¥å¿—ï¼‰
- **æµ‹è¯•**ï¼šâ³ ç­‰å¾…ç”¨æˆ·æµ‹è¯•å¹¶æä¾›åé¦ˆ

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœéŸ³é¢‘æ— æ³•æ’­æ”¾
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ 404/500 é”™è¯¯
2. æ£€æŸ¥éŸ³é¢‘ URL æ ¼å¼ï¼š`https://songbrocade-api.petterbrand03.workers.dev/r2/narratives/audio/nrt_xxx.mp3`
3. ç›´æ¥è®¿é—®éŸ³é¢‘ URLï¼ŒæŸ¥çœ‹æ˜¯å¦è¿”å›éŸ³é¢‘æ–‡ä»¶
4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ CORS é”™è¯¯

### å¦‚æœæ–‡åŒ–æ•…äº‹ä¾ç„¶ä¸æ˜¾ç¤º
1. ç¡®è®¤å·²åœ¨ admin é¡µé¢ç‚¹å‡»"å‘å¸ƒ"
2. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ä¸­çš„ `narratives: Array(X)`ï¼ŒX åº”è¯¥ > 0
3. æ£€æŸ¥æ•…äº‹çš„ `status` å­—æ®µæ˜¯å¦ä¸º `published`

### å¦‚æœåŒ äººå¯¹è¯ä¸å¯ç”¨
1. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ä¸­çš„ `artisan_id`
2. ç¡®è®¤ `artisan_id` æ ¼å¼ä¸º `artisan_XXX`
3. åœ¨å•†å“ç®¡ç†é¡µé¢ä¿®æ”¹ä¸ºæ­£ç¡®çš„åŒ äºº ID

