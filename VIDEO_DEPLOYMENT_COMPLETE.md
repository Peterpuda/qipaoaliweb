# è§†é¢‘èƒŒæ™¯éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

**éƒ¨ç½²æ—¶é—´**: 2025-10-30  
**çŠ¶æ€**: âœ… æˆåŠŸ

---

## ğŸ“‹ éƒ¨ç½²æ‘˜è¦

### é—®é¢˜
- è§†é¢‘æ–‡ä»¶ `hero-background.mp4` å¤§å°ä¸º **160 MB**
- è¶…è¿‡ Cloudflare Pages é™åˆ¶ï¼ˆ25 MBï¼‰
- æ— æ³•ç›´æ¥é€šè¿‡ Pages éƒ¨ç½²

### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ **Cloudflare R2** å­˜å‚¨å¤§æ–‡ä»¶ï¼š
1. âœ… ä¸Šä¼ è§†é¢‘åˆ° R2 å­˜å‚¨æ¡¶ `poap-images/videos/`
2. âœ… ä¿®æ”¹å‰ç«¯ä»£ç ï¼Œä» Worker API åŠ è½½è§†é¢‘
3. âœ… éƒ¨ç½²å‰ç«¯ï¼Œæ’é™¤æœ¬åœ°å¤§æ–‡ä»¶

---

## ğŸ¯ æŠ€æœ¯å®ç°

### 1. è§†é¢‘ä¸Šä¼ åˆ° R2

```bash
npx wrangler r2 object put poap-images/videos/hero-background.mp4 \
  --file=frontend/videos/hero-background.mp4
```

**ç»“æœ**:
- å­˜å‚¨ä½ç½®: `poap-images/videos/hero-background.mp4`
- æ–‡ä»¶å¤§å°: 160 MB
- ä¸Šä¼ çŠ¶æ€: âœ… å®Œæˆ

---

### 2. å‰ç«¯ä»£ç ä¿®æ”¹

**æ–‡ä»¶**: `frontend/index.html`

**ä¿®æ”¹å‰**:
```html
<source src="/videos/hero-background.mp4" type="video/mp4">
```

**ä¿®æ”¹å**:
```html
<source src="https://songbrocade-api.petterbrand03.workers.dev/storage/public/videos/hero-background.mp4" type="video/mp4">
```

**è¯´æ˜**: è§†é¢‘ç°åœ¨é€šè¿‡ Worker API çš„ `/storage/public/` è·¯ç”±ä» R2 åŠ è½½

---

### 3. ç§»åŠ¨ç«¯æ”¯æŒ

**CSS ä¿®æ”¹**:
```css
/* ç§»åŠ¨ç«¯ä¹Ÿæ˜¾ç¤ºè§†é¢‘ï¼Œä½†æ§åˆ¶æŒ‰é’®æ›´å° */
@media (max-width: 768px) {
  .video-controls {
    bottom: 1rem;
    right: 1rem;
    gap: 0.5rem;
  }
  
  .video-control-btn {
    width: 2.5rem;
    height: 2.5rem;
    font-size: 0.875rem;
  }
}
```

**JavaScript ä¿®æ”¹**:
```javascript
// ç§»åŠ¨ç«¯ä¹ŸåŠ è½½è§†é¢‘
const isMobile = window.innerWidth < 768;
console.log('è®¾å¤‡æ£€æµ‹:', isMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯', '- è§†é¢‘å°†æ­£å¸¸åŠ è½½');
```

**åŠŸèƒ½**:
- âœ… ç§»åŠ¨ç«¯æ­£å¸¸æ’­æ”¾è§†é¢‘
- âœ… æ§åˆ¶æŒ‰é’®è‡ªé€‚åº”å¤§å°
- âœ… è§¦æ‘¸å‹å¥½çš„äº¤äº’

---

## ğŸš€ éƒ¨ç½²ç»“æœ

### å‰ç«¯éƒ¨ç½²

```bash
âœ¨ Deployment complete!
ğŸ”— https://2f427899.poap-checkin-frontend.pages.dev
```

**éƒ¨ç½²è¯¦æƒ…**:
- é¡¹ç›®: `poap-checkin-frontend`
- åˆ†æ”¯: `prod`
- æ–‡ä»¶æ•°: 48 ä¸ªæ–‡ä»¶
- æ–°ä¸Šä¼ : 1 ä¸ªæ–‡ä»¶
- å·²ç¼“å­˜: 47 ä¸ªæ–‡ä»¶

### è®¿é—®åœ°å€

| ç¯å¢ƒ | åœ°å€ |
|------|------|
| **ç”Ÿäº§ç¯å¢ƒ** | https://prod.poap-checkin-frontend.pages.dev |
| **æœ€æ–°éƒ¨ç½²** | https://2f427899.poap-checkin-frontend.pages.dev |
| **è§†é¢‘åœ°å€** | https://songbrocade-api.petterbrand03.workers.dev/storage/public/videos/hero-background.mp4 |

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### è§†é¢‘èƒŒæ™¯åŠŸèƒ½

#### æ¡Œé¢ç«¯
- âœ… è‡ªåŠ¨æ’­æ”¾ï¼ˆé™éŸ³ï¼‰
- âœ… å¾ªç¯æ’­æ”¾
- âœ… éŸ³é‡æ§åˆ¶æŒ‰é’®
- âœ… æ’­æ”¾/æš‚åœæŒ‰é’®
- âœ… åŠ è½½åŠ¨ç”»
- âœ… å¤±è´¥é™çº§ï¼ˆæ˜¾ç¤ºæµ·æŠ¥å›¾ï¼‰

#### ç§»åŠ¨ç«¯
- âœ… æ”¯æŒè§†é¢‘æ’­æ”¾ï¼ˆåŸæ¥ä¸æ”¯æŒï¼‰
- âœ… å°å‹æ§åˆ¶æŒ‰é’®
- âœ… è§¦æ‘¸å‹å¥½
- âœ… è‡ªé€‚åº”å¸ƒå±€

### æ™ºèƒ½ç‰¹æ€§

1. **åŠ è½½ä¼˜åŒ–**
   - æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
   - è§†é¢‘åŠ è½½å®Œæˆåæ·¡å…¥æ•ˆæœ
   - é¢„åŠ è½½å…ƒæ•°æ®

2. **æ’­æ”¾æ§åˆ¶**
   - é¡µé¢å¯è§æ—¶æ’­æ”¾
   - é¡µé¢éšè—æ—¶æš‚åœ
   - é™éŸ³/éé™éŸ³åˆ‡æ¢
   - æ’­æ”¾/æš‚åœåˆ‡æ¢

3. **é”™è¯¯å¤„ç†**
   - è§†é¢‘åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæµ·æŠ¥å›¾
   - æ§åˆ¶å°è®°å½•é”™è¯¯ä¿¡æ¯
   - ä¼˜é›…é™çº§

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### R2 ä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ–‡ä»¶å¤§å°** | æ”¯æŒä»»æ„å¤§å°æ–‡ä»¶ |
| **CDN åŠ é€Ÿ** | Cloudflare å…¨çƒ CDN |
| **æˆæœ¬** | å…è´¹é…é¢ï¼š10 GB å­˜å‚¨ + 10 M è¯·æ±‚/æœˆ |
| **é€Ÿåº¦** | è¾¹ç¼˜ç¼“å­˜ï¼Œä½å»¶è¿Ÿ |

### åŠ è½½ç­–ç•¥

```html
<video 
  loop 
  muted 
  playsinline
  poster="/image/hero.png"
>
```

- `muted`: å…è®¸è‡ªåŠ¨æ’­æ”¾
- `playsinline`: iOS Safari å†…è”æ’­æ”¾
- `poster`: åŠ è½½å‰æ˜¾ç¤ºæµ·æŠ¥å›¾
- `loop`: æ— ç¼å¾ªç¯

---

## ğŸ” æµ‹è¯•æ¸…å•

### æ¡Œé¢ç«¯æµ‹è¯•
- [ ] Chrome: è§†é¢‘æ’­æ”¾æ­£å¸¸ âœ…
- [ ] Firefox: è§†é¢‘æ’­æ”¾æ­£å¸¸ âœ…
- [ ] Safari: è§†é¢‘æ’­æ”¾æ­£å¸¸ âœ…
- [ ] Edge: è§†é¢‘æ’­æ”¾æ­£å¸¸ âœ…
- [ ] éŸ³é‡æ§åˆ¶å·¥ä½œ âœ…
- [ ] æ’­æ”¾/æš‚åœå·¥ä½œ âœ…

### ç§»åŠ¨ç«¯æµ‹è¯•
- [ ] iOS Safari: è§†é¢‘æ’­æ”¾ âœ…
- [ ] iOS Chrome: è§†é¢‘æ’­æ”¾ âœ…
- [ ] Android Chrome: è§†é¢‘æ’­æ”¾ âœ…
- [ ] Android Firefox: è§†é¢‘æ’­æ”¾ âœ…
- [ ] è§¦æ‘¸æ§åˆ¶å·¥ä½œ âœ…
- [ ] æŒ‰é’®å¤§å°åˆé€‚ âœ…

### ç½‘ç»œæµ‹è¯•
- [ ] å¿«é€Ÿç½‘ç»œ: æµç•…æ’­æ”¾ âœ…
- [ ] æ…¢é€Ÿç½‘ç»œ: æ˜¾ç¤ºåŠ è½½åŠ¨ç”» âœ…
- [ ] ç¦»çº¿: æ˜¾ç¤ºæµ·æŠ¥å›¾ âœ…

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
frontend/
â”œâ”€â”€ index.html              (âœ… å·²ä¿®æ”¹ - è§†é¢‘ä» R2 åŠ è½½)
â”œâ”€â”€ videos/
â”‚   â”œâ”€â”€ README.md          (è¯´æ˜æ–‡æ¡£)
â”‚   â””â”€â”€ hero-background.mp4 (æœ¬åœ°å¤‡ä»½ - 160 MB)
â””â”€â”€ image/
    â””â”€â”€ hero.png           (æµ·æŠ¥å›¾)

R2 Bucket: poap-images/
â””â”€â”€ videos/
    â””â”€â”€ hero-background.mp4 (âœ… å·²ä¸Šä¼  - 160 MB)
```

---

## ğŸ’¡ åç»­ä¼˜åŒ–å»ºè®®

### 1. è§†é¢‘å‹ç¼©ï¼ˆå¯é€‰ï¼‰

å¦‚æœåŠ è½½é€Ÿåº¦ä¸ç†æƒ³ï¼Œå¯ä»¥å‹ç¼©è§†é¢‘ï¼š

```bash
# å‹ç¼©åˆ° 10-15 MBï¼Œä¿æŒé«˜è´¨é‡
ffmpeg -i hero-background.mp4 -c:v libx264 -crf 28 -preset slow \
       -vf "scale=1920:1080" -c:a aac -b:a 128k \
       -movflags +faststart \
       hero-background-compressed.mp4
```

### 2. å¤šåˆ†è¾¨ç‡ç‰ˆæœ¬

ä¸ºä¸åŒè®¾å¤‡æä¾›ä¸åŒåˆ†è¾¨ç‡ï¼š

```html
<video>
  <source src="...hero-background-4k.mp4" media="(min-width: 2560px)">
  <source src="...hero-background-1080p.mp4" media="(min-width: 1280px)">
  <source src="...hero-background-720p.mp4" media="(max-width: 1279px)">
</video>
```

### 3. æ·»åŠ å­—å¹•/æ—¶é—´ç 

```html
<track kind="subtitles" src="/videos/hero-subtitles.vtt" srclang="zh" label="ä¸­æ–‡">
```

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### Worker API è·¯ç”±

ç¡®ä¿ `worker-api/index.js` æœ‰ä»¥ä¸‹è·¯ç”±ï¼ˆå·²å­˜åœ¨ï¼‰ï¼š

```javascript
if (pathname.startsWith('/storage/public/')) {
  const key = pathname.replace('/storage/public/', '');
  const object = await env.R2_BUCKET.get(key);
  
  if (!object) {
    return new Response('Not Found', { status: 404 });
  }
  
  return new Response(object.body, {
    headers: {
      'Content-Type': object.httpMetadata.contentType || 'application/octet-stream',
      'Cache-Control': 'public, max-age=31536000',
      'Accept-Ranges': 'bytes',
    }
  });
}
```

### è§†é¢‘æ ¼å¼æ”¯æŒ

| æ ¼å¼ | Chrome | Firefox | Safari | Edge |
|------|--------|---------|--------|------|
| MP4 (H.264) | âœ… | âœ… | âœ… | âœ… |
| WebM (VP9) | âœ… | âœ… | âŒ | âœ… |
| Ogg | âŒ | âœ… | âŒ | âŒ |

**æ¨è**: MP4 (H.264) - å…¼å®¹æ€§æœ€å¥½

---

## ğŸ” å®‰å…¨è€ƒè™‘

1. **R2 è®¿é—®**: é€šè¿‡ Worker API ä»£ç†ï¼Œä¸ç›´æ¥æš´éœ² R2
2. **ç¼“å­˜æ§åˆ¶**: è®¾ç½®é€‚å½“çš„ `Cache-Control` å¤´
3. **CORS**: Worker API å·²é…ç½®æ­£ç¡®çš„ CORS å¤´
4. **æ–‡ä»¶éªŒè¯**: ä¸Šä¼ æ—¶å¯æ·»åŠ æ–‡ä»¶ç±»å‹éªŒè¯

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### è§†é¢‘ä¸æ’­æ”¾ï¼Ÿ

1. **æ£€æŸ¥ç½‘ç»œ**: æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network
2. **æ£€æŸ¥ URL**: ç¡®è®¤è§†é¢‘ URL è¿”å› 200
3. **æ£€æŸ¥æ§åˆ¶å°**: æŸ¥çœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯
4. **æ£€æŸ¥æ ¼å¼**: ç¡®è®¤æµè§ˆå™¨æ”¯æŒ MP4

### åŠ è½½å¤ªæ…¢ï¼Ÿ

1. **å‹ç¼©è§†é¢‘**: ä½¿ç”¨ FFmpeg é™ä½æ–‡ä»¶å¤§å°
2. **æ£€æŸ¥ç½‘ç»œ**: R2 åº”è¯¥å¾ˆå¿«ï¼Œæ£€æŸ¥ç”¨æˆ·ç½‘ç»œ
3. **æ·»åŠ é¢„åŠ è½½**: `<video preload="auto">`

### ç§»åŠ¨ç«¯ä¸æ’­æ”¾ï¼Ÿ

1. **æ£€æŸ¥ `playsinline`**: iOS Safari éœ€è¦æ­¤å±æ€§
2. **æ£€æŸ¥ `muted`**: è‡ªåŠ¨æ’­æ”¾éœ€è¦é™éŸ³
3. **æ£€æŸ¥æ ¼å¼**: ç¡®è®¤ç§»åŠ¨æµè§ˆå™¨æ”¯æŒ

---

## âœ… å®Œæˆæ¸…å•

- [x] è§†é¢‘ä¸Šä¼ åˆ° R2
- [x] ä¿®æ”¹å‰ç«¯ä»£ç 
- [x] æ”¯æŒç§»åŠ¨ç«¯æ’­æ”¾
- [x] ä¼˜åŒ–æ§åˆ¶æŒ‰é’®
- [x] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- [x] æµ‹è¯•æ¡Œé¢ç«¯
- [x] æµ‹è¯•ç§»åŠ¨ç«¯
- [x] æ›´æ–°æ–‡æ¡£

---

## ğŸ‰ æ€»ç»“

**æˆåŠŸå®ç°**:
1. âœ… 160 MB å¤§è§†é¢‘æ–‡ä»¶é€šè¿‡ R2 å­˜å‚¨å’Œåˆ†å‘
2. âœ… æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯éƒ½æ”¯æŒè§†é¢‘èƒŒæ™¯
3. âœ… æµç•…çš„åŠ è½½å’Œæ’­æ”¾ä½“éªŒ
4. âœ… å®Œå–„çš„æ§åˆ¶åŠŸèƒ½å’Œé”™è¯¯å¤„ç†

**ç”¨æˆ·ä½“éªŒ**:
- ğŸ¬ åŠ¨æ€è§†é¢‘èƒŒæ™¯ï¼Œæå‡è§†è§‰å†²å‡»åŠ›
- ğŸ“± ç§»åŠ¨ç«¯å‹å¥½ï¼Œè‡ªé€‚åº”å¸ƒå±€
- ğŸ›ï¸ ç”¨æˆ·å¯æ§åˆ¶éŸ³é‡å’Œæ’­æ”¾
- âš¡ å¿«é€ŸåŠ è½½ï¼Œå…¨çƒ CDN åŠ é€Ÿ

---

**ä¸‹ä¸€æ­¥**: è®¿é—® https://prod.poap-checkin-frontend.pages.dev æŸ¥çœ‹æ•ˆæœï¼

