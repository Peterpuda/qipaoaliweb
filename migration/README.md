# æ•°æ®è¿ç§»è„šæœ¬è¯´æ˜

æœ¬ç›®å½•åŒ…å«ä»Cloudflareè¿ç§»åˆ°é˜¿é‡Œäº‘çš„æ‰€æœ‰è„šæœ¬å’Œå·¥å…·ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
migration/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ data/                        # å¯¼å‡ºçš„æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ events.json
â”‚   â”œâ”€â”€ checkins.json
â”‚   â”œâ”€â”€ members.json
â”‚   â”œâ”€â”€ products.json
â”‚   â”œâ”€â”€ artisans.json
â”‚   â”œâ”€â”€ orders.json
â”‚   â”œâ”€â”€ rewards.json
â”‚   â”œâ”€â”€ content_variants.json
â”‚   â”œâ”€â”€ badges_issues.json
â”‚   â””â”€â”€ shipping_info.json
â”œâ”€â”€ r2-files/                    # ä»R2ä¸‹è½½çš„æ–‡ä»¶
â”‚   â”œâ”€â”€ narratives/
â”‚   â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â””â”€â”€ video/
â”‚   â””â”€â”€ products/
â”œâ”€â”€ logs/                        # è¿ç§»æ—¥å¿—
â”œâ”€â”€ scripts/                     # è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ 1-export-d1-data.sh
â”‚   â”œâ”€â”€ 2-import-to-rds.js
â”‚   â”œâ”€â”€ 3-download-r2-files.js
â”‚   â”œâ”€â”€ 4-upload-to-oss.js
â”‚   â”œâ”€â”€ 5-update-urls.js
â”‚   â””â”€â”€ 6-verify-data.js
â””â”€â”€ config/
    â”œâ”€â”€ aliyun.config.js         # é˜¿é‡Œäº‘é…ç½®
    â””â”€â”€ cloudflare.config.js     # Cloudflareé…ç½®
```

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1: å¯¼å‡ºD1æ•°æ®

```bash
cd migration
chmod +x scripts/1-export-d1-data.sh
./scripts/1-export-d1-data.sh
```

è¿™å°†å¯¼å‡ºæ‰€æœ‰è¡¨æ•°æ®åˆ° `data/` ç›®å½•ã€‚

### æ­¥éª¤2: å¯¼å…¥æ•°æ®åˆ°RDS

```bash
# é…ç½®æ•°æ®åº“è¿æ¥
cp config/aliyun.config.example.js config/aliyun.config.js
# ç¼–è¾‘ aliyun.config.jsï¼Œå¡«å†™RDSè¿æ¥ä¿¡æ¯

# è¿è¡Œå¯¼å…¥è„šæœ¬
node scripts/2-import-to-rds.js
```

### æ­¥éª¤3: ä¸‹è½½R2æ–‡ä»¶

```bash
node scripts/3-download-r2-files.js
```

### æ­¥éª¤4: ä¸Šä¼ åˆ°OSS

```bash
node scripts/4-upload-to-oss.js
```

### æ­¥éª¤5: æ›´æ–°æ•°æ®åº“URL

```bash
node scripts/5-update-urls.js
```

### æ­¥éª¤6: éªŒè¯æ•°æ®

```bash
node scripts/6-verify-data.js
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½**: åœ¨æ‰§è¡Œä»»ä½•æ“ä½œå‰ï¼Œç¡®ä¿å·²å¤‡ä»½åŸå§‹æ•°æ®
2. **ç½‘ç»œ**: ç¡®ä¿ç½‘ç»œç¨³å®šï¼Œæ–‡ä»¶ä¼ è¾“å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
3. **æƒé™**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®Cloudflareå’Œé˜¿é‡Œäº‘æœåŠ¡
4. **æµ‹è¯•**: å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è„šæœ¬ï¼Œå†åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

- [ ] å¯¼å‡ºD1æ•°æ®
- [ ] å¯¼å…¥æ•°æ®åˆ°RDS
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§
- [ ] ä¸‹è½½R2æ–‡ä»¶
- [ ] ä¸Šä¼ åˆ°OSS
- [ ] æ›´æ–°URL
- [ ] æœ€ç»ˆéªŒè¯

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜1: å¯¼å‡ºæ•°æ®å¤±è´¥
- æ£€æŸ¥wrangleræ˜¯å¦å·²ç™»å½•
- æ£€æŸ¥D1æ•°æ®åº“åç§°æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### é—®é¢˜2: å¯¼å…¥RDSå¤±è´¥
- æ£€æŸ¥RDSç™½åå•é…ç½®
- æ£€æŸ¥æ•°æ®åº“è¿æ¥ä¿¡æ¯
- æ£€æŸ¥è¡¨æ˜¯å¦å·²åˆ›å»º

### é—®é¢˜3: æ–‡ä»¶ä¸Šä¼ å¤±è´¥
- æ£€æŸ¥OSS AccessKeyé…ç½®
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶

## ğŸ“ è”ç³»æ–¹å¼

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯å›¢é˜Ÿã€‚

