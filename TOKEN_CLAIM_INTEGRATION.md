# ä»£å¸é¢†å–åŠŸèƒ½é›†æˆè¯´æ˜

## âœ… åŠŸèƒ½æ¦‚è¿°

ç°åœ¨ç­¾åˆ°é¡µé¢å·²ç»é›†æˆäº†ä»£å¸é¢†å–åŠŸèƒ½ï¼Œç”¨æˆ·ä½“éªŒæµç¨‹å¦‚ä¸‹ï¼š

1. **è¿æ¥é’±åŒ…** â†’ è¾“å…¥ç­¾åˆ°ç 
2. **ç‚¹å‡»"é“­åˆ»æˆ‘çš„åˆ°åœº"** â†’ å®Œæˆç­¾åˆ°
3. **ç­¾åˆ°æˆåŠŸåè‡ªåŠ¨æ˜¾ç¤º"ğŸ é¢†å– 1000 æšä»£å¸"æŒ‰é’®**
4. **å…³é—­åˆ†äº«å¼¹çª—** â†’ ç‚¹å‡»é¢†å–æŒ‰é’®
5. **ä¸€é”®é¢†å–** â†’ ä»£å¸è‡ªåŠ¨åˆ°è´¦é’±åŒ…

## ğŸ“‹ é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: éƒ¨ç½² ERC20 Merkle Distributor åˆçº¦

```bash
cd contracts

# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env

# ç¼–è¾‘ .envï¼Œå¡«å…¥ï¼š
# PRIVATE_KEY=ä½ çš„ç§é’¥
# BASE_SEPOLIA_RPC=https://sepolia.base.org
# BASESCAN_API_KEY=ä½ çš„ Basescan API Key

# 2. éƒ¨ç½²åˆçº¦
node scripts/deploy-erc20-distributor.js

# è®°å½•è¾“å‡ºçš„åˆçº¦åœ°å€ï¼Œä¾‹å¦‚ï¼š
# âœ… ERC20MerkleDistributor deployed to: 0xABC123...
```

### æ­¥éª¤ 2: é…ç½®å‰ç«¯åˆçº¦åœ°å€

ç¼–è¾‘ `frontend/poap.config.js`ï¼Œå¡«å…¥éƒ¨ç½²çš„åˆçº¦åœ°å€ï¼š

```javascript
window.POAP_CONFIG = {
  WORKER_BASE_URL: "https://songbrocade-api.petterbrand03.workers.dev",
  CHAIN_ID_HEX: "0x14A34",
  RPC_URL: "https://sepolia.base.org",
  EXPLORER: "https://sepolia.basescan.org",
  
  // â­ å¡«å…¥éƒ¨ç½²çš„ Merkle Distributor åˆçº¦åœ°å€
  DISTRIBUTOR_CONTRACT: "0xABC123...", // æ›¿æ¢ä¸ºå®é™…åœ°å€
};
```

### æ­¥éª¤ 3: è½¬å…¥ä»£å¸åˆ°åˆçº¦

ä¸ºäº†è®©åˆçº¦èƒ½å¤Ÿå‘æ”¾ä»£å¸ï¼Œéœ€è¦å°†è¶³å¤Ÿçš„ä»£å¸è½¬å…¥åˆçº¦åœ°å€ï¼š

```solidity
// å‡è®¾ä½ æœ‰ 100 ä¸ªç”¨æˆ·ï¼Œæ¯äºº 1000 æšä»£å¸ï¼ˆ18 decimalsï¼‰
// æ€»éœ€æ±‚ = 100 * 1000 * 10^18 = 100000000000000000000000 wei

// ä½¿ç”¨ MetaMask æˆ–å…¶ä»–é’±åŒ…ï¼Œå°†ä»£å¸è½¬è´¦åˆ°ï¼š
// åˆçº¦åœ°å€: 0xABC123...ï¼ˆä½ éƒ¨ç½²çš„ Distributor åœ°å€ï¼‰
// ä»£å¸åˆçº¦: 0x9Fc8A071c5a6897AD90c8614de5B26e4e75a57Aaï¼ˆBase Sepolia æµ‹è¯•ä»£å¸ï¼‰
```

### æ­¥éª¤ 4: ç”Ÿæˆ Merkle Tree

ç®¡ç†å‘˜éœ€è¦åœ¨æ´»åŠ¨ç»“æŸåç”Ÿæˆ Merkle Treeï¼š

1. è®¿é—®ç®¡ç†åå°ï¼š`https://songbrocade-frontend.pages.dev/admin/merkle.html`
2. è¾“å…¥æ´»åŠ¨ slugï¼ˆä¾‹å¦‚ï¼š`qipao-2025`ï¼‰
3. ç‚¹å‡»"ğŸŒ² ç”Ÿæˆ Merkle Tree"
4. å¤åˆ¶ç”Ÿæˆçš„ Merkle Root
5. **é‡è¦**ï¼šä¿å­˜ç”Ÿæˆçš„ JSON æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†æ¯ä¸ªç”¨æˆ·çš„è¯æ˜ï¼ˆproofï¼‰

### æ­¥éª¤ 5: æ›´æ–°åˆçº¦çš„ Merkle Rootï¼ˆå¦‚éœ€è¦ï¼‰

å¦‚æœä½ çš„åˆçº¦æ”¯æŒæ›´æ–° Merkle Rootï¼ˆä¾‹å¦‚æœ‰ `setMerkleRoot` å‡½æ•°ï¼‰ï¼Œåˆ™éœ€è¦ï¼š

```javascript
// ä½¿ç”¨ ethers.js æˆ– Remix è°ƒç”¨åˆçº¦çš„ setMerkleRoot å‡½æ•°
await distributorContract.setMerkleRoot("0x123abc...æ–°çš„root");
```

**æ³¨æ„**ï¼šå½“å‰éƒ¨ç½²çš„ `ERC20MerkleDistributor` åˆçº¦åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½® Merkle Rootï¼Œå¦‚éœ€æ›´æ–°ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²åˆçº¦ã€‚

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### ç”¨æˆ·ç«¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è®¿é—®ç­¾åˆ°é¡µ â”‚
â”‚   è¿æ¥é’±åŒ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¾“å…¥ç­¾åˆ°ç  â”‚
â”‚   ç‚¹å‡»é“­åˆ»    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç­¾åˆ°æˆåŠŸï¼     â”‚
â”‚ âœ… +10 ç§¯åˆ†       â”‚
â”‚ ğŸ’ è·å¾—ç©ºæŠ•èµ„æ ¼   â”‚
â”‚ (1000æšä»£å¸)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ˜¾ç¤ºé¢†å–æŒ‰é’®   â”‚
â”‚ "ğŸ é¢†å–1000ä»£å¸" â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç‚¹å‡»é¢†å–æŒ‰é’®   â”‚
â”‚   è‡ªåŠ¨æŸ¥è¯¢èµ„æ ¼    â”‚
â”‚   è‡ªåŠ¨è°ƒç”¨åˆçº¦    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. é¢†å–æˆåŠŸï¼     â”‚
â”‚ ğŸ’° ä»£å¸åˆ°è´¦é’±åŒ…   â”‚
â”‚ ğŸ”— æ˜¾ç¤ºäº¤æ˜“å“ˆå¸Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç®¡ç†å‘˜ç«¯æµç¨‹

```
1. ç”¨æˆ·å®Œæˆç­¾åˆ°
   â†“
   åç«¯è‡ªåŠ¨è®°å½•åˆ° airdrop_eligible è¡¨
   (wallet, event_id, amount = 1000 * 10^18)

2. æ´»åŠ¨ç»“æŸåï¼Œè®¿é—® /admin/merkle.html
   â†“
   è¾“å…¥æ´»åŠ¨ slugï¼Œç”Ÿæˆ Merkle Tree
   â†“
   Merkle Root è‡ªåŠ¨å­˜å…¥æ•°æ®åº“ï¼ˆmerkle_batches è¡¨ï¼‰

3. ç”¨æˆ·ç°åœ¨å¯ä»¥åœ¨ç­¾åˆ°é¡µé¢ç›´æ¥é¢†å–ä»£å¸
```

## ğŸ¨ å‰ç«¯äº¤äº’è¯´æ˜

### ç­¾åˆ°æˆåŠŸåçš„å˜åŒ–

**æˆåŠŸå¼¹çª—å†…å®¹**ï¼š
```
ä½ çš„å‚ä¸å·²è¢«è®°å½•ã€‚

ğŸ è·å¾— 10 ç§¯åˆ†ï¼
ğŸ’ å·²è·å¾—ç©ºæŠ•èµ„æ ¼ï¼ˆ1000æšä»£å¸ï¼‰ï¼

å…³é—­æ­¤çª—å£åï¼Œç‚¹å‡»ä¸‹æ–¹ã€Œé¢†å–1000æšä»£å¸ã€æŒ‰é’®å®Œæˆé¢†å–ã€‚
```

**é¡µé¢æ˜¾ç¤º**ï¼š
- ç­¾åˆ°æŒ‰é’®ä¸‹æ–¹è‡ªåŠ¨æ˜¾ç¤ºé‡‘è‰²çš„"ğŸ é¢†å– 1000 æšä»£å¸"æŒ‰é’®
- ç‚¹å‡»åï¼Œåœ¨é¡µé¢åº•éƒ¨æ˜¾ç¤ºé¢†å–è¿›åº¦é¢æ¿ï¼ˆé»‘è‰²èƒŒæ™¯ï¼Œæ©™è‰²è¾¹æ¡†ï¼‰

**é¢†å–çŠ¶æ€æ˜¾ç¤º**ï¼š
```
[18:50:06] æ­£åœ¨æŸ¥è¯¢é¢†å–èµ„æ ¼...
[18:50:07] âœ… èµ„æ ¼éªŒè¯é€šè¿‡ï¼å‡†å¤‡é¢†å– 1000 æšä»£å¸...
[18:50:08] æ­£åœ¨æäº¤é“¾ä¸Šäº¤æ˜“...
[18:50:10] äº¤æ˜“å·²æäº¤ï¼š0xabc123...
ç­‰å¾…ç¡®è®¤...
[18:50:15] ğŸ‰ é¢†å–æˆåŠŸï¼
âœ… å·²åˆ°è´¦ 1000 æšä»£å¸
ğŸ“¦ åŒºå—ï¼š12345678
ğŸ”— äº¤æ˜“ï¼š0xabc123...
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### å‰ç«¯ä»£ç å…³é”®éƒ¨åˆ†

1. **ç­¾åˆ°æˆåŠŸåæ˜¾ç¤ºé¢†å–æŒ‰é’®**ï¼ˆ`frontend/checkin/index.html` ç¬¬ 545 è¡Œï¼‰ï¼š
```javascript
if (eligible && points > 0) {
  setPanel(`ç­¾åˆ°æˆåŠŸï¼è·å¾— ${points} ç§¯åˆ† ğŸ å·²è·å¾—ç©ºæŠ•èµ„æ ¼ ğŸ’`);
  $('claimTokenRow').style.display = 'flex'; // æ˜¾ç¤ºé¢†å–æŒ‰é’®
  openModal(`...å…³é—­æ­¤çª—å£åï¼Œç‚¹å‡»ä¸‹æ–¹ã€Œé¢†å–1000æšä»£å¸ã€æŒ‰é’®å®Œæˆé¢†å–ã€‚`);
}
```

2. **é¢†å–ä»£å¸å‡½æ•°**ï¼ˆ`frontend/checkin/index.html` ç¬¬ 623 è¡Œï¼‰ï¼š
```javascript
async function claimTokens() {
  // 1. éªŒè¯é’±åŒ…è¿æ¥
  // 2. è·å–æ´»åŠ¨ slug
  // 3. è°ƒç”¨åç«¯ API æŸ¥è¯¢é¢†å–èµ„æ ¼å’Œ Merkle è¯æ˜
  // 4. è°ƒç”¨åˆçº¦çš„ claim(index, address, amount, proof) å‡½æ•°
  // 5. ç­‰å¾…äº¤æ˜“ç¡®è®¤å¹¶æ˜¾ç¤ºç»“æœ
}
```

### åç«¯ API ç«¯ç‚¹

- `GET /rewards/v2/eligibility/{batch}/{address}`
  - è¿”å›ï¼š`{ ok, eligible, ready, index, amount, proof }`
  - `ready`: Merkle Tree æ˜¯å¦å·²ç”Ÿæˆ
  - `proof`: ç”¨æˆ·çš„ Merkle è¯æ˜ï¼ˆbytes32[]ï¼‰

### æ™ºèƒ½åˆçº¦æ¥å£

```solidity
// ERC20MerkleDistributor.sol
function claim(
    uint256 index,
    address account,
    uint256 amount,
    bytes32[] calldata proof
) external;
```

## ğŸš¨ é‡è¦æ³¨æ„äº‹é¡¹

1. **åˆçº¦åœ°å€é…ç½®**ï¼šå¿…é¡»åœ¨ `frontend/poap.config.js` ä¸­é…ç½® `DISTRIBUTOR_CONTRACT` åœ°å€
2. **ä»£å¸ä½™é¢**ï¼šç¡®ä¿åˆçº¦åœ°å€æœ‰è¶³å¤Ÿçš„ä»£å¸ä½™é¢
3. **Merkle Tree ç”Ÿæˆ**ï¼šç”¨æˆ·åªèƒ½åœ¨ Merkle Tree ç”Ÿæˆåæ‰èƒ½é¢†å–
4. **ä¸€æ¬¡æ€§é¢†å–**ï¼šæ¯ä¸ªç”¨æˆ·æ¯ä¸ªæ´»åŠ¨åªèƒ½é¢†å–ä¸€æ¬¡ï¼ˆåˆçº¦å±‚é¢é˜²æ­¢é‡å¤é¢†å–ï¼‰
5. **Gas è´¹ç”¨**ï¼šç”¨æˆ·éœ€è¦æ”¯ä»˜ Gas è´¹ï¼ˆBase Sepolia æµ‹è¯•ç½‘ä½¿ç”¨æµ‹è¯• ETHï¼‰

## ğŸ¯ æµ‹è¯•æ¸…å•

- [ ] åˆçº¦éƒ¨ç½²æˆåŠŸï¼Œåœ°å€å·²è®°å½•
- [ ] å‰ç«¯é…ç½®æ–‡ä»¶å·²æ›´æ–°åˆçº¦åœ°å€
- [ ] ä»£å¸å·²è½¬å…¥åˆçº¦åœ°å€
- [ ] å®Œæˆä¸€æ¬¡æµ‹è¯•ç­¾åˆ°
- [ ] ç®¡ç†å‘˜ç”Ÿæˆ Merkle Tree
- [ ] æµ‹è¯•ç”¨æˆ·ç‚¹å‡»é¢†å–æŒ‰é’®
- [ ] ç¡®è®¤ä»£å¸åˆ°è´¦é’±åŒ…
- [ ] éªŒè¯é˜²é‡å¤é¢†å–æœºåˆ¶

## ğŸ“ æ”¯æŒä¿¡æ¯

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
2. é’±åŒ…æ˜¯å¦è¿æ¥åˆ° Base Sepolia æµ‹è¯•ç½‘
3. åˆçº¦æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»£å¸ä½™é¢
4. Merkle Tree æ˜¯å¦å·²ç”Ÿæˆï¼ˆ`ready: true`ï¼‰

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: 2025-10-27  
**å‰ç«¯åœ°å€**: https://songbrocade-frontend.pages.dev  
**åç«¯ API**: https://songbrocade-api.petterbrand03.workers.dev  
**æµ‹è¯•ä»£å¸**: 0x9Fc8A071c5a6897AD90c8614de5B26e4e75a57Aa (Base Sepolia)

